<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DFTæ—‹è½¬å› å­ä¸å¾ªç¯å·ç§¯è¯¦è§£ (æœ€ç»ˆå¢å¼ºç‰ˆ)</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
    <script>
        MathJax = {
            tex: { inlineMath: [['$', '$']], displayMath: [['$$', '$$']] },
            svg: { fontCache: 'global' }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

    <style>
        body { font-family: 'Lato', 'Noto Sans SC', sans-serif; line-height: 1.8; color: #3a3a3a; background-color: #f9fbfd; margin: 0; padding: 0; }
        .container { max-width: 960px; margin: 30px auto; padding: 20px 40px; background-color: #fff; box-shadow: 0 6px 20px rgba(0,0,0,0.07); border-radius: 10px; }
        h1, h2, h3, h4 { font-family: 'Lato', sans-serif; font-weight: 700; color: #2c3e50; margin-top: 40px; }
        h1 { text-align: center; border-bottom: 3px solid #3498db; padding-bottom: 15px; font-size: 2.2em; }
        h2 { border-bottom: 2px solid #e0e0e0; padding-bottom: 10px; font-size: 1.8em; }
        h3 { border-left: 4px solid #3498db; padding-left: 15px; font-size: 1.5em; }
        h4 { border: none; margin-top: 0; color: #34495e; font-size: 1.2em; }
        strong { font-weight: 700; }
        code { background-color: #eef2f7; padding: 3px 7px; border-radius: 5px; font-family: 'SFMono-Regular', Consolas, 'Courier New', monospace; color: #e74c3c; font-size: 0.95em; }
        .canvas-container { text-align: center; margin: 30px 0; padding: 15px; background: #fdfdfd; border-radius: 8px; border: 1px solid #eee;}
        canvas { border: 1px solid #ddd; border-radius: 8px; cursor: pointer; }
        .button-container { text-align: center; margin: 20px 0; }
        .btn { background-color: #3498db; color: white; padding: 12px 25px; border: none; border-radius: 5px; cursor: pointer; font-size: 1em; font-weight: bold; transition: all 0.3s; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .btn:hover { background-color: #2980b9; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.15); }
        .comparison-table { width: 100%; border-collapse: collapse; margin: 25px 0; font-size: 1.1em; }
        .comparison-table th, .comparison-table td { border: 1px solid #ddd; padding: 14px; text-align: center; }
        .comparison-table th { background-color: #34495e; color: white; }
        .comparison-table tbody tr:nth-child(even) { background-color: #f8f9fa; }
        
        #explanation, #linear-conv-explanation { text-align: center; font-family: 'SFMono-Regular', Consolas, 'Courier New', monospace; font-size: 1.1em; min-height: 50px; margin-top: 20px; color: #2c3e50; padding: 10px; background: #f1f8ff; border-radius: 5px;}
        #result-container { display: flex; justify-content: center; gap: 10px; margin-top: 20px; }
        .result-box {
            width: 70px; height: 70px; border: 2px solid #1abc9c; background-color: #e8f8f5;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-weight: bold; border-radius: 8px; color: #16a085; font-size: 1.2em;
            transition: all 0.3s ease; box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .result-box.highlight { transform: scale(1.15); border-color: #f1c40f; box-shadow: 0 0 20px rgba(241, 196, 15, 0.7); }
        .result-box .label { font-size: 0.8em; color: #555; }

        .conv-steps-list { list-style: none; padding: 0; }
        .conv-step { margin-bottom: 25px; padding: 20px; border: 1px solid #e0e0e0; border-radius: 8px; background: #fafcff;}
        .static-row { display: flex; justify-content: center; align-items: center; margin: 10px 0; font-family: 'SFMono-Regular', Consolas, 'Courier New', monospace; font-size: 1.2em;}
        .static-row-label { width: 150px; text-align: right; padding-right: 10px; }
        .static-row-content { display: flex; }
        .static-box { width: 50px; height: 50px; border-radius: 5px; display: flex; align-items: center; justify-content: center; font-weight: bold; margin: 0 5px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .x-box { background-color: #eaf2f8; border: 2px solid #3498db; }
        .h-box { background-color: #f5eef8; border: 2px solid #9b59b6; }
        .result-text { font-weight: bold; color: #16a085; font-size: 1.2em; }
        .info-box { background-color: #eef8f2; border-left: 5px solid #27ae60; padding: 15px 20px; margin: 20px 0; border-radius: 5px; }
        .note-box { background-color: #fff9e6; border-left: 5px solid #f39c12; padding: 15px 20px; margin: 20px 0; border-radius: 5px; }
        .calculation-block { background: #f8f9fa; border: 1px solid #e9ecef; padding: 15px; border-radius: 8px; margin-top: 15px; }
        .calculation-block p { margin: 8px 0; }

        .matrix-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; align-items: start; }
        .matrix-table { border-collapse: collapse; margin: 10px auto; }
        .matrix-table td { border: 1px solid #ccc; padding: 8px; text-align: center; min-width: 45px; }
        .matrix-container { text-align: center; }
        
        .linear-conv-table { width: 100%; border-collapse: collapse; font-family: 'SFMono-Regular', Consolas, 'Courier New', monospace; margin: 20px 0;}
        .linear-conv-table td { border: 1px solid #ddd; padding: 10px; text-align: center; }
        .linear-conv-table .header { background: #f2f2f2; font-weight: bold; }
        .linear-conv-table .label-col { background: #f2f2f2; font-weight: bold; text-align: right; padding-right: 15px; }
        .linear-conv-table .result-col { background: #e8f8f5; font-weight: bold; color: #16a085; }
    </style>
</head>
<body>

<div class="container">
    <h1>DFTæ—‹è½¬å› å­ä¸å¾ªç¯å·ç§¯è¯¦è§£</h1>

    <h2>1. DFTä¸­çš„æ—‹è½¬å› å­ (Twiddle Factor)</h2>
    <h3>å®šä¹‰ä¸å‡ ä½•æ„ä¹‰</h3>
    <p>æ—‹è½¬å› å­ï¼Œè®°ä¸º $W_N$ï¼Œæ˜¯DFTå®šä¹‰ä¸­çš„æ ¸å¿ƒå¤æ•°ã€‚å®ƒä»£è¡¨äº†å¤å¹³é¢å•ä½åœ†ä¸Šçš„ä¸€ä¸ªåŸºæœ¬æ—‹è½¬è§’åº¦ã€‚</p>
    $$ W_N = e^{-j\frac{2\pi}{N}} = \cos\left(\frac{2\pi}{N}\right) - j\sin\left(\frac{2\pi}{N}\right) $$
    <p>åœ¨DFTçš„è®¡ç®—å…¬å¼ $X[k] = \sum_{n=0}^{N-1} x[n] W_N^{kn}$ ä¸­ï¼Œå®ƒçš„å¹‚ $W_N^{kn}$ çš„æ„ä¹‰æ˜¯ï¼š</p>
    $$ W_N^{kn} = (e^{-j\frac{2\pi}{N}})^{kn} = e^{-j\frac{2\pi kn}{N}} $$
    <p>è¿™ä»£è¡¨ä»å¤å¹³é¢çš„ç‚¹ (1, 0) å¼€å§‹ï¼Œæ²¿ç€å•ä½åœ†<strong>é¡ºæ—¶é’ˆ</strong>æ—‹è½¬ $kn$ ä¸ªå¤§å°ä¸º $\frac{2\pi}{N}$ çš„åŸºæœ¬è§’åº¦ã€‚è¿™äº›æ—‹è½¬å› å­æ„æˆäº†DFTçš„<strong>æ­£äº¤åŸº</strong>ï¼Œç”¨äºåˆ†æä¿¡å·åœ¨ä¸åŒé¢‘ç‡åˆ†é‡ä¸Šçš„æŠ•å½±ã€‚</p>
    
    <h3>äº¤äº’å¼å¯è§†åŒ– (N=8)</h3>
    <p>ä¸‹å›¾å±•ç¤ºäº†å½“N=8æ—¶ï¼Œ8ä¸ªåŸºæœ¬æ—‹è½¬å› å­ $W_8^k$ åœ¨å¤å¹³é¢å•ä½åœ†ä¸Šçš„ä½ç½®ã€‚å°†é¼ æ ‡æ‚¬åœåœ¨ç‚¹ä¸Šå¯ä»¥æŸ¥çœ‹å…¶è¯¦ç»†ä¿¡æ¯ã€‚</p>
    <div class="canvas-container">
        <canvas id="twiddleCanvas" width="450" height="450"></canvas>
    </div>
    
    <h2>2. å¾ªç¯å·ç§¯çš„ç›´è§‚ç†è§£ï¼šä¸ºä½•ç§°ä¸ºâ€œå¾ªç¯â€ï¼Ÿ</h2>
    <p>çº¿æ€§å·ç§¯æ˜¯åœ¨ä¸€æ¡æ— é™é•¿çš„ç›´çº¿ä¸Šè¿›è¡Œçš„ï¼Œè€Œ<strong>å¾ªç¯å·ç§¯æ˜¯åœ¨ä¸€ä¸ªåœ†å‘¨ä¸Šè¿›è¡Œçš„</strong>ã€‚è¿™ä¸ªå‡ ä½•æ¨¡å‹æ˜¯ç†è§£å…¶ç‰¹æ€§çš„å…³é”®ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å››æ­¥æ¥å½¢è±¡åœ°ç†è§£è¿™ä¸ªè¿‡ç¨‹ï¼š</p>
    <ol>
        <li>å°†åºåˆ— $x[n]$ çš„Nä¸ªç‚¹å‡åŒ€åœ°å¸ƒç½®åœ¨ä¸€ä¸ªå›ºå®šçš„<strong>å¤–åœˆ</strong>ä¸Šã€‚</li>
        <li>å°†åºåˆ— $h[n]$ è¿›è¡Œ<strong>æ—¶é—´åè½¬</strong>ï¼Œå¾—åˆ° $h[-m \pmod N]$ã€‚</li>
        <li>å°†åè½¬åçš„ $h$ åºåˆ—å¸ƒç½®åœ¨ä¸€ä¸ªå¯æ—‹è½¬çš„<strong>å†…åœˆ</strong>ä¸Šï¼Œå¹¶ä¸å¤–åœˆçš„èµ·å§‹ç‚¹å¯¹é½ã€‚</li>
        <li>è®¡ç®— $y[0]$ï¼šå°†å†…å¤–åœˆå¯¹é½çš„å…ƒç´ ç›¸ä¹˜å†æ±‚å’Œã€‚ç„¶åï¼Œå°†<strong>å†…åœˆé¡ºæ—¶é’ˆæ—‹è½¬ä¸€æ ¼</strong>ï¼Œè®¡ç®— $y[1]$ï¼Œå¦‚æ­¤å¾ªç¯å¾€å¤ï¼Œç›´åˆ°è®¡ç®—å‡ºæ‰€æœ‰Nä¸ªè¾“å‡ºç‚¹ã€‚</li>
    </ol>
    
    <div style="text-align:center; margin: 30px 0;">
        <svg width="600" height="300" viewbox="0 0 600 300">
             <defs>
                <path id="circle-text-outer" d="M 100,150 A 100,100 0 1,1 300,150 A 100,100 0 1,1 100,150"></path>
                <path id="circle-text-inner" d="M 125,150 A 75,75 0 1,1 275,150 A 75,75 0 1,1 125,150"></path>
                <g id="inner-circle-group">
                    <circle cx="200" cy="150" r="75" stroke="#9b59b6" stroke-width="3" fill="none"></circle>
                    <text font-family="Courier New, monospace" font-size="24" font-weight="bold" fill="#5e3370" stroke="white" stroke-width="0.8px" paint-order="stroke">
                        <textPath xlink:href="#circle-text-inner" startOffset="5%">h[0]  h[-1]  h[-2] ...</textPath>
                    </text>
                    <animateTransform attributeName="transform" type="rotate" from="0 200 150" to="360 200 150" dur="10s" repeatCount="indefinite"></animateTransform>
                </g>
            </defs>
            <circle cx="200" cy="150" r="100" stroke="#3498db" stroke-width="3" fill="none"></circle>
            <text font-family="Courier New, monospace" font-size="24" font-weight="bold" fill="#21618c" stroke="white" stroke-width="0.8px" paint-order="stroke">
                <textPath xlink:href="#circle-text-outer" startOffset="5%">x[0]  x[1]  x[2] ... x[N-1]</textPath>
            </text>
            <use xlink:href="#inner-circle-group"></use>
            <text x="350" y="150" font-family="Noto Sans SC, sans-serif" font-size="20" fill="#444">å†…åœˆåè½¬åï¼Œä¸æ–­æ—‹è½¬</text>
        </svg>
    </div>

    <h2>3. å¾ªç¯å·ç§¯åŠ¨ç”» (N=4)</h2>
    <p>ä»¥ä¸‹åŠ¨ç”»ç›´è§‚æ¼”ç¤ºäº† $x[n] = \{1, 2, 2, 1\}$ å’Œ $h[n] = \{1, 0, 1, 0\}$ çš„4ç‚¹å¾ªç¯å·ç§¯è¿‡ç¨‹ã€‚</p>
    <div class="button-container">
        <button class="btn" onclick="runCircularConvolutionAnimation()">æ’­æ”¾/é‡ç½®åŠ¨ç”»</button>
    </div>
    <div class="canvas-container">
        <canvas id="convolutionCanvas" width="400" height="400"></canvas>
    </div>
    <div id="explanation">ç‚¹å‡»æŒ‰é’®å¼€å§‹åŠ¨ç”»</div>
    <div id="result-container"></div>

    <h2>4. å¾ªç¯å·ç§¯è®¡ç®—è¿‡ç¨‹</h2>
    <p>å¾ªç¯å·ç§¯çš„æ•°å­¦å®šä¹‰ä¸ºï¼š</p>
    $$ y[n] = x[n] \circledast_N h[n] = \sum_{m=0}^{N-1} x[m] h[(n-m) \pmod N] $$
    <div class="note-box">
        <h4>ğŸ’¡ ä»€ä¹ˆæ˜¯æ¨¡è¿ç®— (mod N)ï¼Ÿ</h4>
        <p>æ¨¡è¿ç®—ï¼ˆModulo Operationï¼‰æ˜¯æ±‚ä½™æ•°çš„è¿‡ç¨‹ã€‚åœ¨å¤„ç†åºåˆ—ç´¢å¼•æ—¶ï¼Œå®ƒç¡®ä¿ç´¢å¼•å§‹ç»ˆè½åœ¨ <code>[0, N-1]</code> çš„èŒƒå›´å†…ï¼Œå°±åƒæ—¶é’Ÿä¸€æ ·ã€‚</p>
        <p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªé•¿åº¦ä¸º N=4 çš„åºåˆ— $h[n] = \{h_0, h_1, h_2, h_3\}$ã€‚å½“æˆ‘ä»¬è®¿é—®è¶…å‡ºèŒƒå›´çš„ç´¢å¼•æ—¶ï¼š</p>
        <ul>
            <li><strong>æ­£å‘å¾ªç¯</strong>ï¼šç´¢å¼• $h[4]$ å®é™…ä¸Šæ˜¯ $h[4 \pmod 4] = h[0]$ã€‚$h[8]$ å®é™…ä¸Šæ˜¯ $h[8 \pmod 4] = h[0]$ã€‚</li>
            <li><strong>åå‘å¾ªç¯</strong>ï¼šç´¢å¼• $h[-1]$ å®é™…ä¸Šæ˜¯ $h[-1 \pmod 4] = h[3]$ã€‚$h[-8]$ å®é™…ä¸Šæ˜¯ $h[-8 \pmod 4] = h[0]$ã€‚</li>
        </ul>
        <p>è¿™æ­£æ˜¯â€œå¾ªç¯â€æˆ–â€œå‘¨æœŸâ€ç‰¹æ€§çš„æ•°å­¦ä½“ç°ã€‚</p>
    </div>

    <h3>æ–¹æ³•ä¸€ï¼šæ—¶åŸŸåˆ†æ­¥è®¡ç®—å›¾ç¤º</h3>
    <ol class="conv-steps-list">
        <li class="conv-step">
            <h4>è®¡ç®— y[0]: (håºåˆ—åˆå§‹å¯¹é½)</h4>
            <div class="static-row"><div class="static-row-label">$x[m]$:</div><div class="static-row-content"><div class="static-box x-box">1</div><div class="static-box x-box">2</div><div class="static-box x-box">2</div><div class="static-box x-box">1</div></div></div>
            <div class="static-row"><div class="static-row-label">$h[-m]$:</div><div class="static-row-content"><div class="static-box h-box">1</div><div class="static-box h-box">0</div><div class="static-box h-box">1</div><div class="static-box h-box">0</div></div></div>
            <div class="static-row" style="border-top: 1px solid #ccc; padding-top: 10px;">(1Ã—1)+(2Ã—0)+(2Ã—1)+(1Ã—0) = <strong class="result-text">3</strong></div>
        </li>
        <li class="conv-step">
            <h4>è®¡ç®— y[1]: (håºåˆ—å¾ªç¯å³ç§»ä¸€ä½)</h4>
            <div class="static-row"><div class="static-row-label">$x[m]$:</div><div class="static-row-content"><div class="static-box x-box">1</div><div class="static-box x-box">2</div><div class="static-box x-box">2</div><div class="static-box x-box">1</div></div></div>
            <div class="static-row"><div class="static-row-label">$h[1-m]$:</div><div class="static-row-content"><div class="static-box h-box">0</div><div class="static-box h-box">1</div><div class="static-box h-box">0</div><div class="static-box h-box">1</div></div></div>
            <div class="static-row" style="border-top: 1px solid #ccc; padding-top: 10px;">(1Ã—0)+(2Ã—1)+(2Ã—0)+(1Ã—1) = <strong class="result-text">3</strong></div>
        </li>
        <li class="conv-step">
            <h4>è®¡ç®— y[2]: (håºåˆ—å†å¾ªç¯å³ç§»ä¸€ä½)</h4>
            <div class="static-row"><div class="static-row-label">$x[m]$:</div><div class="static-row-content"><div class="static-box x-box">1</div><div class="static-box x-box">2</div><div class="static-box x-box">2</div><div class="static-box x-box">1</div></div></div>
            <div class="static-row"><div class="static-row-label">$h[2-m]$:</div><div class="static-row-content"><div class="static-box h-box">1</div><div class="static-box h-box">0</div><div class="static-box h-box">1</div><div class="static-box h-box">0</div></div></div>
            <div class="static-row" style="border-top: 1px solid #ccc; padding-top: 10px;">(1Ã—1)+(2Ã—0)+(2Ã—1)+(1Ã—0) = <strong class="result-text">3</strong></div>
        </li>
        <li class="conv-step">
            <h4>è®¡ç®— y[3]: (håºåˆ—å†å¾ªç¯å³ç§»ä¸€ä½)</h4>
            <div class="static-row"><div class="static-row-label">$x[m]$:</div><div class="static-row-content"><div class="static-box x-box">1</div><div class="static-box x-box">2</div><div class="static-box x-box">2</div><div class="static-box x-box">1</div></div></div>
            <div class="static-row"><div class="static-row-label">$h[3-m]$:</div><div class="static-row-content"><div class="static-box h-box">0</div><div class="static-box h-box">1</div><div class="static-box h-box">0</div><div class="static-box h-box">1</div></div></div>
            <div class="static-row" style="border-top: 1px solid #ccc; padding-top: 10px;">(1Ã—0)+(2Ã—1)+(2Ã—0)+(1Ã—1) = <strong class="result-text">3</strong></div>
        </li>
    </ol>
    <div class="info-box"><strong>æœ€ç»ˆç»“æœï¼š$y[n] = \{3, 3, 3, 3\}$</strong></div>
    
    <h3>æ–¹æ³•äºŒï¼šé¢‘åŸŸè®¡ç®— (DFTæ³•)</h3>
    <p>è¯¥æ–¹æ³•åŸºäºç¦»æ•£å·ç§¯å®šç†ï¼š<strong>æ—¶åŸŸçš„å¾ªç¯å·ç§¯ç­‰ä»·äºé¢‘åŸŸçš„ä¹˜ç§¯</strong>ã€‚</p>
    
    <div class="calculation-block">
        <h4>æ­¥éª¤1.1: è®¡ç®— $X[k] = \text{DFT}(\{1, 2, 2, 1\})$</h4>
        <p>$X[k] = \sum_{n=0}^{3} x[n] W_4^{kn}$, å…¶ä¸­ $W_4^0=1, W_4^1=-j, W_4^2=-1, W_4^3=j$</p>
        <p>$X[0] = 1(1) + 2(1) + 2(1) + 1(1) = 6$</p>
        <p>$X[1] = 1(W_4^0) + 2(W_4^1) + 2(W_4^2) + 1(W_4^3) = 1(1) + 2(-j) + 2(-1) + 1(j) = -1 - j$</p>
        <p>$X[2] = 1(W_4^0) + 2(W_4^2) + 2(W_4^4) + 1(W_4^6) = 1(1) + 2(-1) + 2(1) + 1(-1) = 0$</p>
        <p>$X[3] = 1(W_4^0) + 2(W_4^3) + 2(W_4^6) + 1(W_4^9) = 1(1) + 2(j) + 2(-1) + 1(-j) = -1 + j$</p>
        <p><strong>ç»“æœ: $X[k] = \{6, -1-j, 0, -1+j\}$</strong></p>
    </div>
    
    <div class="calculation-block">
        <h4>æ­¥éª¤1.2: è®¡ç®— $H[k] = \text{DFT}(\{1, 0, 1, 0\})$</h4>
        <p>$H[k] = \sum_{n=0}^{3} h[n] W_4^{kn}$</p>
        <p>$H[0] = 1(1) + 0(1) + 1(1) + 0(1) = 2$</p>
        <p>$H[1] = 1(W_4^0) + 0(W_4^1) + 1(W_4^2) + 0(W_4^3) = 1(1) + 1(-1) = 0$</p>
        <p>$H[2] = 1(W_4^0) + 0(W_4^2) + 1(W_4^4) + 0(W_4^6) = 1(1) + 1(1) = 2$</p>
        <p>$H[3] = 1(W_4^0) + 0(W_4^3) + 1(W_4^6) + 0(W_4^9) = 1(1) + 1(-1) = 0$</p>
        <p><strong>ç»“æœ: $H[k] = \{2, 0, 2, 0\}$</strong></p>
    </div>

    <div class="calculation-block">
        <h4>æ­¥éª¤2: åœ¨é¢‘åŸŸè¿›è¡Œå…ƒç´ çº§ä¹˜ç§¯ $Y[k] = X[k] \cdot H[k]$</h4>
        <p>$Y[0] = 6 \times 2 = 12$</p>
        <p>$Y[1] = (-1-j) \times 0 = 0$</p>
        <p>$Y[2] = 0 \times 2 = 0$</p>
        <p>$Y[3] = (-1+j) \times 0 = 0$</p>
        <p><strong>ç»“æœ: $Y[k] = \{12, 0, 0, 0\}$</strong></p>
    </div>

    <div class="calculation-block">
        <h4>æ­¥éª¤3: å¯¹ä¹˜ç§¯ç»“æœè¿›è¡Œé€†DFT (IDFT)</h4>
        <p>è®¡ç®— $y[n] = \text{IDFT}(Y[k]) = \frac{1}{4}\sum_{k=0}^{3} Y[k] W_4^{-kn}$</p>
        <p>ç”±äºåªæœ‰$Y[0]$ä¸ä¸ºé›¶ï¼Œå…¬å¼ç®€åŒ–ä¸º $y[n] = \frac{1}{4}(Y[0]W_4^{-0n}) = \frac{1}{4}(12 \cdot 1) = 3$</p>
        <p>è¿™ä¸ªç»“æœå¯¹æ‰€æœ‰n (0, 1, 2, 3) éƒ½æˆç«‹ï¼Œæ‰€ä»¥æœ€ç»ˆå¾—åˆ° <strong>$y[n] = \{3, 3, 3, 3\}$</strong>ã€‚</p>
    </div>

    <h3>æ–¹æ³•ä¸‰ï¼šçŸ©é˜µå½¢å¼çš„DFT</h3>
    <p>DFTçš„æ±‚å’Œè¿ç®—å¯ä»¥ç­‰æ•ˆåœ°å†™æˆçŸ©é˜µä¸å‘é‡çš„ä¹˜æ³•å½¢å¼ï¼Œè¿™åœ¨ç†è®ºåˆ†æå’Œç®—æ³•å®ç°ï¼ˆå¦‚FFTï¼‰ä¸­éƒ½éå¸¸é‡è¦ã€‚</p>
    $$ \begin{bmatrix} X[0] \\ X[1] \\ \vdots \\ X[N-1] \end{bmatrix} = \begin{bmatrix} W_N^{0} & W_N^{0} & \cdots & W_N^{0} \\ W_N^{0} & W_N^{1} & \cdots & W_N^{N-1} \\ \vdots & \vdots & \ddots & \vdots \\ W_N^{0} & W_N^{N-1} & \cdots & W_N^{(N-1)^2} \end{bmatrix} \begin{bmatrix} x[0] \\ x[1] \\ \vdots \\ x[N-1] \end{bmatrix} $$
    <p>è¿™ä¸ªæ ¸å¿ƒçš„æ–¹é˜µè¢«ç§°ä¸º<strong>DFTçŸ©é˜µ</strong>ã€‚ä¸‹é¢å±•ç¤ºäº†ä¸€äº›å¸¸è§Nå€¼çš„DFTçŸ©é˜µåŠå…¶å…·ä½“æ•°å€¼ã€‚</p>
    
    <div class="matrix-grid">
        <div class="matrix-container">
            <h4>N=2</h4>
            <strong>ç¬¦å·çŸ©é˜µ</strong>
            <table class="matrix-table">
                <tr><td>$W_2^0$</td><td>$W_2^0$</td></tr>
                <tr><td>$W_2^0$</td><td>$W_2^1$</td></tr>
            </table>
            <strong>æ•°å€¼çŸ©é˜µ</strong>
            <table class="matrix-table">
                <tr><td>$1$</td><td>$1$</td></tr>
                <tr><td>$1$</td><td>$-1$</td></tr>
            </table>
        </div>
        <div class="matrix-container">
            <h4>N=3</h4>
            <strong>ç¬¦å·çŸ©é˜µ</strong>
            <table class="matrix-table">
                <tr><td>$W_3^0$</td><td>$W_3^0$</td><td>$W_3^0$</td></tr>
                <tr><td>$W_3^0$</td><td>$W_3^1$</td><td>$W_3^2$</td></tr>
                <tr><td>$W_3^0$</td><td>$W_3^2$</td><td>$W_3^4$</td></tr>
            </table>
            <strong>æ•°å€¼çŸ©é˜µ</strong>
            <table class="matrix-table">
                <tr><td>$1$</td><td>$1$</td><td>$1$</td></tr>
                <tr><td>$1$</td><td>$e^{-j2\pi/3}$</td><td>$e^{-j4\pi/3}$</td></tr>
                <tr><td>$1$</td><td>$e^{-j4\pi/3}$</td><td>$e^{-j8\pi/3}$</td></tr>
            </table>
        </div>
        <div class="matrix-container">
            <h4>N=4</h4>
            <strong>ç¬¦å·çŸ©é˜µ</strong>
            <table class="matrix-table">
                <tr><td>$W_4^0$</td><td>$W_4^0$</td><td>$W_4^0$</td><td>$W_4^0$</td></tr>
                <tr><td>$W_4^0$</td><td>$W_4^1$</td><td>$W_4^2$</td><td>$W_4^3$</td></tr>
                <tr><td>$W_4^0$</td><td>$W_4^2$</td><td>$W_4^4$</td><td>$W_4^6$</td></tr>
                <tr><td>$W_4^0$</td><td>$W_4^3$</td><td>$W_4^6$</td><td>$W_4^9$</td></tr>
            </table>
            <strong>æ•°å€¼çŸ©é˜µ</strong>
            <table class="matrix-table">
                <tr><td>$1$</td><td>$1$</td><td>$1$</td><td>$1$</td></tr>
                <tr><td>$1$</td><td>$-j$</td><td>$-1$</td><td>$j$</td></tr>
                <tr><td>$1$</td><td>$-1$</td><td>$1$</td><td>$-1$</td></tr>
                <tr><td>$1$</td><td>$j$</td><td>$-1$</td><td>$-j$</td></tr>
            </table>
        </div>
    </div>
    <div class="matrix-container" style="margin-top: 30px;">
        <h4>N=8 çš„DFTçŸ©é˜µ (ç¬¦å·)</h4>
        <table class="matrix-table" style="font-size: 0.9em; margin: 10px auto;">
            <tbody><tr><th>k\n</th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th></tr>
            <tr><th>0</th><td>$W_8^0$</td><td>$W_8^0$</td><td>$W_8^0$</td><td>$W_8^0$</td><td>$W_8^0$</td><td>$W_8^0$</td><td>$W_8^0$</td><td>$W_8^0$</td></tr>
            <tr><th>1</th><td>$W_8^0$</td><td>$W_8^1$</td><td>$W_8^2$</td><td>$W_8^3$</td><td>$W_8^4$</td><td>$W_8^5$</td><td>$W_8^6$</td><td>$W_8^7$</td></tr>
            <tr><th>2</th><td>$W_8^0$</td><td>$W_8^2$</td><td>$W_8^4$</td><td>$W_8^6$</td><td>$W_8^8$</td><td>$W_8^{10}$</td><td>$W_8^{12}$</td><td>$W_8^{14}$</td></tr>
            <tr><th>3</th><td>$W_8^0$</td><td>$W_8^3$</td><td>$W_8^6$</td><td>$W_8^9$</td><td>$W_8^{12}$</td><td>$W_8^{15}$</td><td>$W_8^{18}$</td><td>$W_8^{21}$</td></tr>
            <tr><th>4</th><td>$W_8^0$</td><td>$W_8^4$</td><td>$W_8^8$</td><td>$W_8^{12}$</td><td>$W_8^{16}$</td><td>$W_8^{20}$</td><td>$W_8^{24}$</td><td>$W_8^{28}$</td></tr>
            <tr><th>5</th><td>$W_8^0$</td><td>$W_8^5$</td><td>$W_8^{10}$</td><td>$W_8^{15}$</td><td>$W_8^{20}$</td><td>$W_8^{25}$</td><td>$W_8^{30}$</td><td>$W_8^{35}$</td></tr>
            <tr><th>6</th><td>$W_8^0$</td><td>$W_8^6$</td><td>$W_8^{12}$</td><td>$W_8^{18}$</td><td>$W_8^{24}$</td><td>$W_8^{30}$</td><td>$W_8^{36}$</td><td>$W_8^{42}$</td></tr>
            <tr><th>7</th><td>$W_8^0$</td><td>$W_8^7$</td><td>$W_8^{14}$</td><td>$W_8^{21}$</td><td>$W_8^{28}$</td><td>$W_8^{35}$</td><td>$W_8^{42}$</td><td>$W_8^{49}$</td></tr>
        </tbody></table>
    </div>

    <h2>5. çº¿æ€§å·ç§¯ (Linear Convolution) å›é¡¾</h2>
    <h3>ç†è®ºä¸åŠ¨ç”»</h3>
    <p>çº¿æ€§å·ç§¯å¯ä»¥æƒ³è±¡æˆä¸€ä¸ªåºåˆ—åè½¬åï¼Œåœ¨å¦ä¸€ä¸ªåºåˆ—ä¸Šâ€œæ»‘çª—ç›¸ä¹˜æ±‚å’Œâ€çš„è¿‡ç¨‹ã€‚å…¶ç»“æœçš„é•¿åº¦ä¸º $L = N_1 + N_2 - 1$ã€‚</p>
    <div class="button-container">
        <button class="btn" onclick="runLinearConvolutionAnimation()">æ’­æ”¾/é‡ç½®çº¿æ€§å·ç§¯åŠ¨ç”»</button>
    </div>
    <div class="canvas-container">
        <canvas id="linearConvolutionCanvas" width="800" height="300"></canvas>
    </div>
    <div id="linear-conv-explanation">ç‚¹å‡»æŒ‰é’®å¼€å§‹åŠ¨ç”»</div>

    <h3>è¡¨æ ¼è®¡ç®—æ³•</h3>
    <p>å¯¹äº $x[n] = \{1, 2, 2, 1\}$ å’Œ $h[n] = \{1, 0, 1, 0\}$ï¼Œç»“æœé•¿åº¦ä¸º $L = 4+4-1=7$ã€‚è¡¨æ ¼æ³•å¯ä»¥æ¸…æ™°åœ°å±•ç¤ºæ¯ä¸€æ­¥çš„è®¡ç®—ï¼š</p>
    <table class="linear-conv-table">
        <tbody>
            <tr><td class="label-col">$x[m]$</td><td></td><td>1</td><td>2</td><td>2</td><td>1</td><td></td><td></td><td></td><td></td></tr>
            <tr><td class="label-col">$h[-m]$ (åè½¬)</td><td>...</td><td>0</td><td>1</td><td>0</td><td>1</td><td>...</td><td></td><td></td><td></td></tr>
            <tr style="height:20px;"></tr>
            <tr class="header"><td class="label-col">è®¡ç®—æ­¥éª¤</td><td colspan="8">åºåˆ— $h[n-m]$ (æ»‘åŠ¨)</td><td class="result-col">y[n]</td></tr>
            <tr><td class="label-col">$y[0]$</td><td>...</td><td style="background:#e8daef">1</td><td style="background:#aed6f1">0</td><td style="background:#aed6f1">1</td><td style="background:#aed6f1">0</td><td>...</td><td></td><td></td><td>$1 \times 1 = 1$</td><td class="result-col">1</td></tr>
            <tr><td class="label-col">$y[1]$</td><td>...</td><td>1</td><td style="background:#e8daef">0</td><td style="background:#aed6f1">1</td><td style="background:#aed6f1">0</td><td>...</td><td></td><td></td><td>$1 \times 0 + 2 \times 1 = 2$</td><td class="result-col">2</td></tr>
            <tr><td class="label-col">$y[2]$</td><td>...</td><td></td><td>1</td><td style="background:#e8daef">0</td><td style="background:#aed6f1">1</td><td style="background:#aed6f1">0</td><td>...</td><td></td><td>$1 \times 1 + 2 \times 0 + 2 \times 1 = 3$</td><td class="result-col">3</td></tr>
            <tr><td class="label-col">$y[3]$</td><td>...</td><td></td><td></td><td>1</td><td style="background:#e8daef">0</td><td style="background:#aed6f1">1</td><td style="background:#aed6f1">0</td><td>...</td><td>$1 \times 0 + 2 \times 1 + 2 \times 0 + 1 \times 1 = 3$</td><td class="result-col">3</td></tr>
            <tr><td class="label-col">$y[4]$</td><td>...</td><td></td><td></td><td></td><td>1</td><td style="background:#e8daef">0</td><td style="background:#aed6f1">1</td><td>0</td><td>$2 \times 0 + 2 \times 1 + 1 \times 0 = 2$</td><td class="result-col">2</td></tr>
            <tr><td class="label-col">$y[5]$</td><td>...</td><td></td><td></td><td></td><td></td><td>1</td><td style="background:#e8daef">0</td><td>1</td><td>$2 \times 0 + 1 \times 1 = 1$</td><td class="result-col">1</td></tr>
            <tr><td class="label-col">$y[6]$</td><td>...</td><td></td><td></td><td></td><td></td><td></td><td>1</td><td>0</td><td>$1 \times 0 = 0$</td><td class="result-col">0</td></tr>
        </tbody>
    </table>

    <h2>6. å¯¹æ¯”ä¸ç»“è®º</h2>
    <table class="comparison-table">
        <thead><tr><th>å·ç§¯ç±»å‹</th><th>ç»“æœåºåˆ—</th><th>é•¿åº¦</th></tr></thead>
        <tbody>
            <tr><td><strong>4ç‚¹å¾ªç¯å·ç§¯</strong></td><td><code>{3, 3, 3, 3}</code></td><td>4</td></tr>
            <tr><td><strong>çº¿æ€§å·ç§¯</strong></td><td><code>{1, 2, 3, 3, 2, 1, 0}</code></td><td>7</td></tr>
        </tbody>
    </table>
    
    <h3>ç»“æœå·®å¼‚çš„æ ¹æºï¼šå‘¨æœŸå»¶æ‹“æ··å </h3>
    <p>å¾ªç¯å·ç§¯çš„ç»“æœä¸çº¿æ€§å·ç§¯ä¸åŒï¼Œæ˜¯å› ä¸ºDFTéšå«åœ°å°†ä¿¡å·è§†ä¸ºæ— é™å‘¨æœŸåºåˆ—ã€‚è¿™å¯¼è‡´çº¿æ€§å·ç§¯ç»“æœä¸­è¶…å‡ºNä¸ªç‚¹çš„éƒ¨åˆ†ï¼ˆâ€œå°¾éƒ¨â€ï¼‰ä¼šâ€œå·ç»•â€å›æ¥ï¼Œä¸ç»“æœçš„â€œå¤´éƒ¨â€ç›¸åŠ ã€‚è¿™ä¸ªæ•ˆåº”ç§°ä¸º<strong>å‘¨æœŸå»¶æ‹“æ··å  (Periodic Extension Aliasing)</strong>ã€‚</p>
    <p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†çº¿æ€§å·ç§¯çš„ç»“æœä»¥å‘¨æœŸN=4è¿›è¡Œå åŠ æ¥éªŒè¯ï¼š</p>
    <div style="font-family: 'SFMono-Regular', Consolas, 'Courier New', monospace; font-size: 1.1em; background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px auto; max-width: 550px;">
        <div style="display: flex; justify-content: flex-start; margin-bottom: 5px;">
            <div style="width: 160px; color: #555;">çº¿æ€§ç»“æœ:</div>
            <div class="static-box x-box" style="width: 40px; height: 40px;">1</div>
            <div class="static-box x-box" style="width: 40px; height: 40px;">2</div>
            <div class="static-box x-box" style="width: 40px; height: 40px;">3</div>
            <div class="static-box x-box" style="width: 40px; height: 40px;">3</div>
            <div class="static-box h-box" style="width: 40px; height: 40px; opacity: 0.5;">2</div>
            <div class="static-box h-box" style="width: 40px; height: 40px; opacity: 0.5;">1</div>
            <div class="static-box h-box" style="width: 40px; height: 40px; opacity: 0.5;">0</div>
        </div>
        <div style="display: flex; justify-content: flex-start; margin-bottom: 10px;">
            <div style="width: 160px; color: #555;">å·ç»•éƒ¨åˆ†:</div>
            <div style="width: 180px; text-align: center; font-size: 1.5em; color: #555;">+</div>
            <div class="static-box h-box" style="width: 40px; height: 40px;">2</div>
            <div class="static-box h-box" style="width: 40px; height: 40px;">1</div>
            <div class="static-box h-box" style="width: 40px; height: 40px;">0</div>
        </div>
        <hr style="border: 0; border-top: 2px dashed #ccc; margin: 10px 0;">
        <div style="display: flex; justify-content: flex-start;">
            <div style="width: 160px; color: #16a085; font-weight: bold;">å¾ªç¯ç»“æœ:</div>
            <div class="static-box" style="width: 40px; height: 40px; background-color:#e8f8f5; border: 2px solid #1abc9c;">3</div>
            <div class="static-box" style="width: 40px; height: 40px; background-color:#e8f8f5; border: 2px solid #1abc9c;">3</div>
            <div class="static-box" style="width: 40px; height: 40px; background-color:#e8f8f5; border: 2px solid #1abc9c;">3</div>
            <div class="static-box" style="width: 40px; height: 40px; background-color:#e8f8f5; border: 2px solid #1abc9c;">3</div>
        </div>
    </div>
    <p>è¿™å®Œç¾åœ°è§£é‡Šäº†ä¸¤ä¸ªç»“æœä¹‹é—´çš„å…³ç³»ã€‚ä¸ºäº†ç”¨å¾ªç¯å·ç§¯è®¡ç®—çº¿æ€§å·ç§¯ï¼Œéœ€è¦å¯¹åŸå§‹ä¿¡å·è¿›è¡Œ<strong>è¡¥é›¶ (Zero Padding)</strong>ï¼Œä½¿å®ƒä»¬çš„é•¿åº¦è‡³å°‘ä¸º $N_1+N_2-1$ã€‚</p>

</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- 1. Twiddle Factor Canvas Drawing ---
        function drawTwiddleFactors() {
            const canvas = document.getElementById('twiddleCanvas');
            if (!canvas || !canvas.getContext) return;
            const ctx = canvas.getContext('2d');
            const N = 8;
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = canvas.width / 2 - 60;
            let hoveredIndex = -1;

            const points = [];
            for (let k = 0; k < N; k++) {
                const angle = -k * 2 * Math.PI / N;
                points.push({
                    x: centerX + radius * Math.cos(angle),
                    y: centerY + radius * Math.sin(angle),
                    angle_rad: -angle,
                });
            }
            
            function redraw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                ctx.beginPath();
                ctx.moveTo(0, centerY); ctx.lineTo(canvas.width, centerY);
                ctx.moveTo(centerX, 0); ctx.lineTo(centerX, canvas.height);
                ctx.strokeStyle = '#bdc3c7'; ctx.stroke();
                ctx.fillStyle = '#7f8c8d'; ctx.font = '14px Lato';
                ctx.fillText('Real', canvas.width - 40, centerY - 10);
                ctx.fillText('Imaginary', centerX + 10, 20);

                ctx.beginPath();
                ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
                ctx.setLineDash([5, 5]); ctx.strokeStyle = '#7f8c8d'; ctx.stroke(); ctx.setLineDash([]);

                points.forEach((p, k) => {
                    const isHovered = (k === hoveredIndex);
                    ctx.beginPath(); ctx.moveTo(centerX, centerY); ctx.lineTo(p.x, p.y);
                    ctx.strokeStyle = isHovered ? '#2980b9' : 'rgba(52, 152, 219, 0.5)';
                    ctx.lineWidth = isHovered ? 2.5 : 1.5;
                    ctx.stroke();
                    ctx.beginPath(); ctx.arc(p.x, p.y, isHovered ? 8 : 5, 0, 2 * Math.PI);
                    ctx.fillStyle = isHovered ? '#3498db' : '#e74c3c'; ctx.fill();
                    ctx.fillStyle = isHovered ? '#2c3e50' : '#7f8c8d';
                    ctx.font = isHovered ? 'bold 16px Lato' : '14px Lato';
                    const textX = centerX + (radius + 35) * Math.cos(-p.angle_rad);
                    const textY = centerY - (radius + 35) * Math.sin(-p.angle_rad);
                    ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                    ctx.fillText(`W\u2088^${k}`, textX, textY);
                });
                
                if (hoveredIndex !== -1) {
                    const p = points[hoveredIndex];
                    const re = Math.cos(p.angle_rad).toFixed(3);
                    const im = Math.sin(p.angle_rad).toFixed(3);
                    ctx.fillStyle = '#2c3e50';
                    ctx.font = 'bold 14px "Courier New"';
                    ctx.textAlign = 'left';
                    ctx.fillText(`Value: ${re} + j(${im})`, 20, 30);
                    ctx.fillText(`Angle: ${(p.angle_rad * 180 / Math.PI).toFixed(1)}Â°`, 20, 50);
                }
            }
            redraw();
            
            canvas.addEventListener('mousemove', (e) => {
                const rect = canvas.getBoundingClientRect();
                const mouseX = e.clientX - rect.left;
                const mouseY = e.clientY - rect.top;
                let found = false;
                for (let k = 0; k < points.length; k++) {
                    const dx = mouseX - points[k].x;
                    const dy = mouseY - points[k].y;
                    if (dx * dx + dy * dy < 15 * 15) {
                        if (hoveredIndex !== k) {
                            hoveredIndex = k;
                            redraw();
                        }
                        found = true;
                        break;
                    }
                }
                if (!found && hoveredIndex !== -1) {
                    hoveredIndex = -1;
                    redraw();
                }
            });
            canvas.addEventListener('mouseleave', () => {
                 hoveredIndex = -1;
                 redraw();
            });
        }
        
        // --- 2. Circular Convolution Canvas Animation ---
        const convCanvas = document.getElementById('convolutionCanvas');
        if (convCanvas) {
            const convCtx = convCanvas.getContext('2d');
            const x_seq_circ = [1, 2, 2, 1];
            const h_seq_circ = [1, 0, 1, 0];
            const N_conv_circ = 4;
            const h_flipped_circ = [h_seq_circ[0], h_seq_circ[3], h_seq_circ[2], h_seq_circ[1]];
            let anim_circ_state = { id: null };
            
            const resultContainer = document.getElementById('result-container');
            resultContainer.innerHTML = '';
            for(let i=0; i<N_conv_circ; i++) {
                resultContainer.innerHTML += `<div class="result-box" id="y_res_${i}"><span class="label">y[${i}]</span><span class="value">?</span></div>`;
            }

            function drawConvolutionState(rotation_n = 0, highlight_m = -1) {
                const centerX = convCanvas.width / 2;
                const centerY = convCanvas.height / 2;
                const R_outer = 160, R_inner = 100, box_size = 50;
                
                convCtx.clearRect(0, 0, convCanvas.width, convCanvas.height);
                
                for (let m = 0; m < N_conv_circ; m++) {
                    const angle = (m / N_conv_circ) * 2 * Math.PI - Math.PI / 2;
                    const x_outer = centerX + R_outer * Math.cos(angle);
                    const y_outer = centerY + R_outer * Math.sin(angle);
                    drawCircleBox(convCtx, x_outer, y_outer, box_size, x_seq_circ[m], '#aed6f1', '#3498db', m === highlight_m);
                }

                convCtx.save();
                convCtx.translate(centerX, centerY);
                convCtx.rotate((rotation_n / N_conv_circ) * 2 * Math.PI);
                convCtx.translate(-centerX, -centerY);
                
                for (let m = 0; m < N_conv_circ; m++) {
                    const angle = (m / N_conv_circ) * 2 * Math.PI - Math.PI / 2;
                    const x_inner = centerX + R_inner * Math.cos(angle);
                    const y_inner = centerY + R_inner * Math.sin(angle);
                    const aligned_m = (m + Math.round(rotation_n)) % N_conv_circ;
                    drawCircleBox(convCtx, x_inner, y_inner, box_size, h_flipped_circ[m], '#e8daef', '#9b59b6', aligned_m === highlight_m);
                }
                convCtx.restore();
            }

            function drawCircleBox(ctx, x, y, size, text, bgColor, borderColor, isHighlighted) {
                ctx.beginPath();
                ctx.arc(x, y, size / 2, 0, 2 * Math.PI);
                ctx.fillStyle = bgColor;
                ctx.fill();
                ctx.strokeStyle = isHighlighted ? '#f1c40f' : borderColor;
                ctx.lineWidth = isHighlighted ? 4 : 2;
                ctx.stroke();
                ctx.fillStyle = '#2c3e50'; ctx.font = 'bold 20px Lato';
                ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
                ctx.fillText(text, x, y);
            }

            window.runCircularConvolutionAnimation = function() {
                if (anim_circ_state.id) cancelAnimationFrame(anim_circ_state.id);
                const explanation_div = document.getElementById('explanation');

                for(let i=0; i<N_conv_circ; i++) {
                    const resBox = document.getElementById(`y_res_${i}`);
                    resBox.querySelector('.value').textContent = '?';
                    resBox.classList.remove('highlight');
                }
                drawConvolutionState(0);
                
                function animateStep(n) {
                    if (n >= N_conv_circ) {
                        explanation_div.innerHTML = `<strong>è®¡ç®—å®Œæˆ! y = {3, 3, 3, 3}</strong>`;
                        return;
                    }

                    document.querySelectorAll('.result-box.highlight').forEach(el => el.classList.remove('highlight'));
                    document.getElementById(`y_res_${n}`).classList.add('highlight');
                    explanation_div.innerHTML = `è®¡ç®— <strong>y[${n}]</strong>: å†…åœˆæ—‹è½¬ ${n} æ ¼...`;

                    let startTime = null;
                    const rotationDuration = 800;
                    
                    function animateRotation(timestamp) {
                        if (!startTime) startTime = timestamp;
                        const elapsed = timestamp - startTime;
                        if (elapsed < rotationDuration) {
                            const progress = elapsed / rotationDuration;
                            const prev_n = (n > 0) ? n - 1 : n;
                            drawConvolutionState(prev_n + (n - prev_n) * progress);
                            anim_circ_state.id = requestAnimationFrame(animateRotation);
                        } else {
                            drawConvolutionState(n);
                            calculateSum(n);
                        }
                    }
                    anim_circ_state.id = requestAnimationFrame(animateRotation);
                }

                function calculateSum(n) {
                    let sum = 0;
                    let current_m = 0;
                    let explanationText = `y[${n}] = `;

                    function highlightPair() {
                        if (current_m >= N_conv_circ) {
                            document.getElementById(`y_res_${n}`).querySelector('.value').textContent = sum;
                            explanation_div.innerHTML = `${explanationText.slice(0, -3)} = <strong>${sum}</strong>`;
                            drawConvolutionState(n, -1);
                            setTimeout(() => animateStep(n + 1), 1000);
                            return;
                        }
                        const h_aligned_val = h_flipped_circ[(current_m - n + N_conv_circ) % N_conv_circ];
                        sum += x_seq_circ[current_m] * h_aligned_val;
                        explanationText += `(${x_seq_circ[current_m]}Ã—${h_aligned_val}) + `;
                        explanation_div.innerHTML = explanationText + "...";
                        
                        drawConvolutionState(n, current_m);
                        current_m++;
                        setTimeout(highlightPair, 600);
                    }
                    highlightPair();
                }
                animateStep(0);
            }
            drawConvolutionState(0);
        }
        
        // --- 3. Linear Convolution Animation ---
        const linearCanvas = document.getElementById('linearConvolutionCanvas');
        if (linearCanvas) {
            const linearCtx = linearCanvas.getContext('2d');
            const x_seq_lin = [1, 2, 2, 1];
            const h_seq_lin = [1, 0, 1, 0];
            const h_flipped_lin = [...h_seq_lin].reverse();
            const L = x_seq_lin.length + h_seq_lin.length - 1;
            let anim_lin_state = { id: null };
            
            function drawLinearConvState(n, highlightIndex = -1) {
                const boxSize = 50;
                const spacing = 10;
                const totalWidth = (x_seq_lin.length + h_flipped_lin.length - 1) * (boxSize + spacing);
                const startX = (linearCanvas.width - totalWidth) / 2;
                
                linearCtx.clearRect(0, 0, linearCanvas.width, linearCanvas.height);
                
                // Draw static sequence x[n]
                x_seq_lin.forEach((val, i) => {
                    const x_pos = startX + (i + h_flipped_lin.length - 1) * (boxSize + spacing);
                    drawRectBox(linearCtx, x_pos, 80, boxSize, val, '#aed6f1', '#3498db', i === highlightIndex);
                });

                // Draw sliding sequence h[n-m]
                const slideOffset = n;
                h_flipped_lin.forEach((val, i) => {
                    const x_pos = startX + (slideOffset + i) * (boxSize + spacing);
                    const static_idx = slideOffset + i - (h_flipped_lin.length - 1);
                    const isHighlighted = (static_idx >= 0 && static_idx < x_seq_lin.length) && (static_idx === highlightIndex);
                    drawRectBox(linearCtx, x_pos, 160, boxSize, val, '#e8daef', '#9b59b6', isHighlighted);
                });
            }

            function drawRectBox(ctx, x, y, size, text, bgColor, borderColor, isHighlighted) {
                ctx.fillStyle = bgColor;
                ctx.strokeStyle = isHighlighted ? '#f1c40f' : borderColor;
                ctx.lineWidth = isHighlighted ? 4 : 2;
                ctx.fillRect(x, y, size, size);
                ctx.strokeRect(x, y, size, size);
                
                ctx.fillStyle = '#2c3e50';
                ctx.font = 'bold 20px Lato';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(text, x + size / 2, y + size / 2);
            }
            
            window.runLinearConvolutionAnimation = function() {
                if (anim_lin_state.id) cancelAnimationFrame(anim_lin_state.id);
                const explanationDiv = document.getElementById('linear-conv-explanation');

                function animateStep(n) {
                    if (n >= L) {
                        explanationDiv.innerHTML = `<strong>è®¡ç®—å®Œæˆ! y = {1, 2, 3, 3, 2, 1, 0}</strong>`;
                        return;
                    }
                    
                    explanationDiv.innerHTML = `è®¡ç®— <strong>y[${n}]</strong>...`;
                    
                    let sum = 0;
                    let current_k = 0;
                    let explanationText = `y[${n}] = `;
                    
                    function highlightPair() {
                        const h_idx = h_flipped_lin.length - 1 - current_k;
                        const x_idx = n - h_idx;

                        if (current_k >= h_flipped_lin.length || x_idx >= x_seq_lin.length) {
                             if(explanationText.endsWith(' + ')) {
                                 explanationText = explanationText.slice(0, -3);
                             }
                             explanationDiv.innerHTML = `${explanationText} = <strong>${sum}</strong>`;
                             drawLinearConvState(n, -1);
                             setTimeout(() => animateStep(n + 1), 1000);
                             return;
                        }

                        if (x_idx >= 0) {
                            const val_x = x_seq_lin[x_idx];
                            const val_h = h_flipped_lin[h_idx];
                            if(val_x * val_h !== 0 || (val_x === 0 && val_h === 0)){
                                sum += val_x * val_h;
                                explanationText += `(${val_x}Ã—${val_h}) + `;
                            }
                            explanationDiv.innerHTML = explanationText + "...";
                            drawLinearConvState(n, x_idx);
                        }
                        
                        current_k++;
                        setTimeout(highlightPair, 500);
                    }
                    
                    drawLinearConvState(n);
                    setTimeout(highlightPair, 800);
                }
                animateStep(0);
            }
            drawLinearConvState(-1); 
        }
        
        drawTwiddleFactors();
    });
</script>

</body>
</html>