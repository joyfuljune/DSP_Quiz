<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIR æ»¤æ³¢å™¨è®¾è®¡æ·±åº¦è§£æï¼šç±»å‹ä¸çº¦æŸ</title>
    
    <!-- 1. MathJax é…ç½® (æ”¾åœ¨è„šæœ¬åŠ è½½ä¹‹å‰) -->
    <script>
    window.MathJax = {
      tex: { 
          // å¼€å¯å•ç¾å…ƒç¬¦å· $...$ ä½œä¸ºè¡Œå†…å…¬å¼
          inlineMath: [['$', '$'], ['\\(', '\\)']], 
          // å¼€å¯åŒç¾å…ƒç¬¦å· $$...$$ ä½œä¸ºå—çº§å…¬å¼
          displayMath: [['$$', '$$'], ['\\[', '\\]']]
      },
      options: {
        // å…è®¸åœ¨è¿™äº›æ ‡ç­¾å†…éƒ¨æ¸²æŸ“
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
        ignoreHtmlClass: 'tex2jax_ignore',
        processHtmlClass: 'tex2jax_process'
      },
      startup: {
        // ç¡®ä¿é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ¸²æŸ“ä¸€é
        typeset: true 
      }
    };
    </script>
    
    <!-- åŠ è½½ MathJax æ ¸å¿ƒè„šæœ¬ -->
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --bg: #f4f7f6;
            --card-bg: #ffffff;
            --text: #333;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: "Segoe UI", "Microsoft YaHei", sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding-bottom: 50px;
            line-height: 1.7;
        }

        .container { max-width: 900px; margin: 0 auto; padding: 20px; }

        header {
            background: linear-gradient(135deg, #1a2a3a, #2c3e50);
            color: white;
            padding: 40px 20px;
            text-align: center;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            margin-bottom: 30px;
        }

        h1 { margin: 0; font-size: 1.8rem; }
        h2 { border-left: 5px solid var(--secondary); padding-left: 10px; color: var(--primary); margin-top: 30px; }

        .card {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 25px;
        }

        /* -------------------
           åŒºåŸŸ 1: äº¤äº’å®éªŒ
           ------------------- */
        .lab-layout {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }
        @media (max-width: 768px) { .lab-layout { grid-template-columns: 1fr; } }

        .canvas-box {
            background: #fff;
            border: 1px solid #eee;
            border-radius: 8px;
            position: relative;
        }
        canvas { width: 100%; display: block; cursor: ns-resize; }

        .controls {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .control-group label { font-weight: bold; font-size: 0.9rem; display: block; margin-bottom: 5px; }
        .toggle-btn-group { display: flex; gap: 5px; background: #e9ecef; padding: 3px; border-radius: 6px; }
        .toggle-btn {
            flex: 1; border: none; padding: 8px; background: transparent; cursor: pointer; border-radius: 4px; font-size: 0.9rem; transition: 0.2s;
        }
        .toggle-btn.active { background: white; box-shadow: 0 1px 3px rgba(0,0,0,0.1); font-weight: bold; color: var(--secondary); }

        /* -------------------
           åŒºåŸŸ 2: ç±»å‹é€‰æ‹©
           ------------------- */
        .type-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }

        .type-item {
            background: #fff;
            border: 2px solid #eee;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }
        .type-item:hover { transform: translateY(-3px); border-color: var(--secondary); }
        .type-item.selected { 
            border-color: var(--secondary); 
            background-color: #f0f7ff; 
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        .type-item h3 { margin: 5px 0; font-size: 1.1rem; color: var(--primary); }
        .type-item p { font-size: 0.85rem; color: #666; margin: 5px 0; }
        
        /* è¿·ä½ å›¾ç¤º SVG */
        .mini-diagram { height: 50px; margin: 10px auto; display: block; }
        .line { stroke: #333; stroke-width: 2; }
        .stem { stroke: #3498db; stroke-width: 2; }
        .dot { fill: #3498db; }
        .axis { stroke: #ccc; stroke-width: 1; }

        /* å¼•å¯¼æç¤ºæ ·å¼ */
        .hint-badge {
            display: inline-block;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-left: 10px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.02); }
        }

        /* -------------------
           åŒºåŸŸ 3: è¯¦æƒ…å±•ç¤º
           ------------------- */
        #detailSection { 
            animation: fadeIn 0.4s; 
            border: 2px solid #e8f4fc;
            background: linear-gradient(to bottom, #f8fcff, #ffffff);
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .detail-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; align-items: start; }
        @media (max-width: 768px) { .detail-layout { grid-template-columns: 1fr; } }

        .math-box {
            background: #fdfdfd;
            border-left: 4px solid var(--secondary);
            padding: 15px;
            font-size: 0.95rem;
            margin-bottom: 15px;
            overflow-x: auto;
            border-radius: 0 8px 8px 0;
        }
        
        .explanation-box {
            background: #fff8e1;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ffe082;
        }
        .explanation-title { font-weight: bold; color: #d35400; margin-bottom: 8px; display: block; }

        .freq-plot-container {
            text-align: center;
            background: #fff;
            border: 1px solid #eee;
            padding: 15px;
            border-radius: 8px;
        }
        
        .tag { display: inline-block; padding: 4px 10px; border-radius: 4px; font-size: 0.8rem; margin-right: 5px; margin-bottom: 5px; font-weight: bold; }
        .tag-good { background: #d4edda; color: #155724; }
        .tag-bad { background: #f8d7da; color: #721c24; }

        /* å…³é”®ç‚¹é«˜äº®æ ·å¼ */
        .key-point {
            background: linear-gradient(120deg, #ffeaa7 0%, #fdcb6e 100%);
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: 600;
        }

        /* æ€»ç»“è¡¨æ ¼æ ·å¼ */
        .summary-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        .summary-table th, .summary-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        .summary-table th {
            background: #f8f9fa;
            font-weight: bold;
        }
        .summary-table tr:hover {
            background: #f5f5f5;
        }
        .check { color: #27ae60; font-weight: bold; }
        .cross { color: #e74c3c; font-weight: bold; }

        /* æç¤ºæ¡† */
        .tip-box {
            background: #e8f6ff;
            border-left: 4px solid #3498db;
            padding: 12px 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
            font-size: 0.9rem;
        }
        .tip-box::before {
            content: "ğŸ’¡ ";
        }

        /* æ‹–åŠ¨æç¤º */
        .drag-hint {
            position: absolute;
            bottom: 10px;
            right: 10px;
            font-size: 0.8rem;
            color: #666;
            background: rgba(255,255,255,0.9);
            padding: 4px 8px;
            border-radius: 4px;
        }

    </style>
</head>
<body>

<header>
    <h1>FIR æ»¤æ³¢å™¨è®¾è®¡ï¼šå¯¹ç§°ç»“æ„ä¸é¢‘ç‡çº¦æŸ</h1>
    <p style="opacity: 0.9; margin-top: 10px;">ä¸ºä»€ä¹ˆé€‰æ‹©å¶æ•°é•¿åº¦å°±åšä¸äº†é«˜é€šï¼Ÿæ¢ç´¢ä¸‹æ–¹å†…å®¹æ­æ™“ç­”æ¡ˆã€‚</p>
</header>

<div class="container">

    <!-- ç¬¬ä¸€éƒ¨åˆ†ï¼šäº¤äº’å®éªŒ -->
    <div class="card">
        <h2>1. ç»“æ„å®éªŒå®¤ï¼šåŠ¨æ‰‹ä½“éªŒå¯¹ç§°æ€§</h2>
        <div class="tip-box">
            æ‹–åŠ¨å·¦ä¾§çš„è“è‰²åœ†ç‚¹æ”¹å˜ç³»æ•°å€¼ï¼Œè§‚å¯Ÿå³ä¾§é•œåƒç‚¹å¦‚ä½•è‡ªåŠ¨ä¿æŒå¯¹ç§°/åå¯¹ç§°å…³ç³»ã€‚
        </div>
        <div class="lab-layout">
            <div class="canvas-box">
                <canvas id="stemCanvas" height="250"></canvas>
                <div class="drag-hint">
                    â†• æ‹–åŠ¨è“ç‚¹ï¼Œè§‚å¯Ÿå¯¹ç§°å˜åŒ–
                </div>
            </div>
            
            <div class="controls">
                <!-- é•¿åº¦ N æ§åˆ¶ -->
                <div class="control-group">
                    <label>æ»¤æ³¢å™¨é•¿åº¦ N (Length): <span id="valN">11</span></label>
                    <input type="range" id="sliderN" min="4" max="21" value="11" step="1" style="width: 100%;">
                    <div style="font-size: 0.8rem; color: #666; margin-top: 5px;">
                        é˜¶æ•° (Order) M = <span id="valOrder">10</span>
                    </div>
                </div>

                <!-- å¯¹ç§°æ€§å¼€å…³ -->
                <div class="control-group">
                    <label>å¯¹ç§°ç±»å‹ (Symmetry):</label>
                    <div class="toggle-btn-group">
                        <button class="toggle-btn active" id="btnSym" onclick="setMode('sym')">å¶å¯¹ç§° (Sym)</button>
                        <button class="toggle-btn" id="btnAnti" onclick="setMode('anti')">å¥‡å¯¹ç§° (Anti)</button>
                    </div>
                    <!-- åŠ¨æ€å…¬å¼åŒºåŸŸ -->
                    <div style="font-size: 0.85rem; color: #555; margin-top: 10px; background: #eee; padding: 8px; border-radius: 4px;" id="symDesc">
                        $$h[n] = h[N-1-n]$$
                        <div style="margin-top:5px; font-size:0.8rem">ç›¸ä½æ–œç‡æ’å®š</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ç¬¬äºŒéƒ¨åˆ†ï¼šç±»å‹é€‰æ‹© -->
    <div class="card">
        <h2>2. å››ç§çº¿æ€§ç›¸ä½ç±»å‹ <span class="hint-badge">ğŸ‘† ç‚¹å‡»å¡ç‰‡æŸ¥çœ‹è¯¦æƒ…</span></h2>
        <p style="font-size: 0.9rem; color: #666; margin-bottom: 15px;">
            FIR ç³»ç»Ÿçš„é¢‘ç‡ç‰¹æ€§ç”± <strong>é•¿åº¦ N çš„å¥‡å¶</strong> å’Œ <strong>å¯¹ç§°æ€§</strong> å…±åŒå†³å®šã€‚æ¯ç§ç±»å‹éƒ½æœ‰å…¶ç‹¬ç‰¹çš„çº¦æŸæ¡ä»¶ã€‚
        </p>
        
        <div class="type-grid">
            <!-- Type 1 -->
            <div class="type-item" onclick="selectType(1)" id="card1">
                <h3>Type I</h3>
                <p>N=å¥‡æ•°, å¶å¯¹ç§°</p>
                <!-- SVG ç¤ºæ„å›¾ -->
                <svg class="mini-diagram" viewBox="0 0 100 50">
                    <line x1="0" y1="25" x2="100" y2="25" class="axis"/>
                    <line x1="20" y1="25" x2="20" y2="10" class="stem"/> <circle cx="20" cy="10" r="2" class="dot"/>
                    <line x1="50" y1="25" x2="50" y2="5" class="stem"/> <circle cx="50" cy="5" r="2" class="dot"/>
                    <line x1="80" y1="25" x2="80" y2="10" class="stem"/> <circle cx="80" cy="10" r="2" class="dot"/>
                </svg>
            </div>

            <!-- Type 2 -->
            <div class="type-item" onclick="selectType(2)" id="card2">
                <h3>Type II</h3>
                <p>N=å¶æ•°, å¶å¯¹ç§°</p>
                <svg class="mini-diagram" viewBox="0 0 100 50">
                    <line x1="0" y1="25" x2="100" y2="25" class="axis"/>
                    <line x1="30" y1="25" x2="30" y2="10" class="stem"/> <circle cx="30" cy="10" r="2" class="dot"/>
                    <line x1="70" y1="25" x2="70" y2="10" class="stem"/> <circle cx="70" cy="10" r="2" class="dot"/>
                    <!-- ä¸­é—´æ— ç‚¹ -->
                </svg>
            </div>

            <!-- Type 3 -->
            <div class="type-item" onclick="selectType(3)" id="card3">
                <h3>Type III</h3>
                <p>N=å¥‡æ•°, å¥‡å¯¹ç§°</p>
                <svg class="mini-diagram" viewBox="0 0 100 50">
                    <line x1="0" y1="25" x2="100" y2="25" class="axis"/>
                    <line x1="20" y1="25" x2="20" y2="10" class="stem"/> <circle cx="20" cy="10" r="2" class="dot"/>
                    <line x1="50" y1="25" x2="50" y2="25" class="stem" style="stroke:#e74c3c"/> <circle cx="50" cy="25" r="2" style="fill:#e74c3c"/>
                    <line x1="80" y1="25" x2="80" y2="40" class="stem"/> <circle cx="80" cy="40" r="2" class="dot"/>
                </svg>
            </div>

            <!-- Type 4 -->
            <div class="type-item" onclick="selectType(4)" id="card4">
                <h3>Type IV</h3>
                <p>N=å¶æ•°, å¥‡å¯¹ç§°</p>
                <svg class="mini-diagram" viewBox="0 0 100 50">
                    <line x1="0" y1="25" x2="100" y2="25" class="axis"/>
                    <line x1="30" y1="25" x2="30" y2="10" class="stem"/> <circle cx="30" cy="10" r="2" class="dot"/>
                    <line x1="70" y1="25" x2="70" y2="40" class="stem"/> <circle cx="70" cy="40" r="2" class="dot"/>
                </svg>
            </div>
        </div>
    </div>

    <!-- ç¬¬ä¸‰éƒ¨åˆ†ï¼šåŠ¨æ€è¯¦æƒ… (è®¾è®¡çº¦æŸ) -->
    <div class="card" id="detailSection">
        <h2 id="detailTitle">è¯¦è§£ï¼šType I (Nå¥‡, å¶å¯¹ç§°)</h2>
        
        <div class="detail-layout">
            <!-- å·¦ä¾§ï¼šæ•°å­¦ä¸åŸç†è§£é‡Š -->
            <div>
                <div class="math-box tex2jax_process">
                    <strong>å¹…åº¦å“åº”å…¬å¼ï¼š</strong>
                    <div id="mathContent" style="padding: 10px 0;">
                        $$ H(\omega) = e^{-j\omega \frac{N-1}{2}} \sum_{n=0}^{(N-1)/2} a[n] \cos(\omega n) $$
                    </div>
                </div>

                <div class="explanation-box">
                    <span class="explanation-title">ğŸ’¡ é€šä¿—è§£é‡Šï¼š</span>
                    <p id="plainText" style="margin: 0; font-size: 0.95rem;">
                        è¿™æ˜¯æœ€å®Œç¾çš„ç±»å‹ã€‚<strong>æ²¡æœ‰ä»»ä½•å¼ºåˆ¶é›¶ç‚¹</strong>ã€‚ä½ å¯ä»¥ç”¨å®ƒè®¾è®¡ä½é€šã€é«˜é€šã€å¸¦é€šã€å¸¦é˜»ç­‰ä»»ä½•æ»¤æ³¢å™¨ã€‚å®ƒæ˜¯ FIR è®¾è®¡ä¸­çš„ä¸‡é‡‘æ²¹ã€‚
                    </p>
                </div>

                <div style="margin-top: 15px;" id="capabilities">
                    <span class="tag tag-good">ä½é€š OK</span>
                    <span class="tag tag-good">é«˜é€š OK</span>
                    <span class="tag tag-good">å¸¦é€š OK</span>
                </div>
            </div>

            <!-- å³ä¾§ï¼šé¢‘ç‡å“åº”ç¤ºæ„å›¾ -->
            <div class="freq-plot-container">
                <canvas id="freqCanvas" width="300" height="200"></canvas>
                <p style="font-size: 0.8rem; color: #666; margin-top:5px;">å¹…åº¦å“åº” $|H(\omega)|$ ç¤ºæ„å›¾</p>
            </div>
        </div>
    </div>

    <!-- ç¬¬å››éƒ¨åˆ†ï¼šæ€»ç»“è¡¨æ ¼ -->
    <div class="card">
        <h2>3. å¿«é€Ÿå‚è€ƒï¼šå››ç±»å‹å¯¹æ¯”æ€»ç»“</h2>
        <p style="font-size: 0.9rem; color: #666; margin-bottom: 10px;">
            æ ¹æ®ä½ çš„æ»¤æ³¢å™¨éœ€æ±‚ï¼Œé€‰æ‹©åˆé€‚çš„ç±»å‹ï¼š
        </p>
        <table class="summary-table">
            <thead>
                <tr>
                    <th>ç±»å‹</th>
                    <th>é•¿åº¦ N</th>
                    <th>å¯¹ç§°æ€§</th>
                    <th>$\omega=0$ (DC)</th>
                    <th>$\omega=\pi$ (é«˜é¢‘)</th>
                    <th>é€‚ç”¨åœºæ™¯</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Type I</strong></td>
                    <td>å¥‡æ•°</td>
                    <td>å¶å¯¹ç§°</td>
                    <td class="check">âœ“ æ— çº¦æŸ</td>
                    <td class="check">âœ“ æ— çº¦æŸ</td>
                    <td>é€šç”¨ï¼ˆæ¨èï¼‰</td>
                </tr>
                <tr>
                    <td><strong>Type II</strong></td>
                    <td>å¶æ•°</td>
                    <td>å¶å¯¹ç§°</td>
                    <td class="check">âœ“ æ— çº¦æŸ</td>
                    <td class="cross">âœ— å¼ºåˆ¶ä¸º0</td>
                    <td>ä½é€šã€å¸¦é€š</td>
                </tr>
                <tr>
                    <td><strong>Type III</strong></td>
                    <td>å¥‡æ•°</td>
                    <td>å¥‡å¯¹ç§°</td>
                    <td class="cross">âœ— å¼ºåˆ¶ä¸º0</td>
                    <td class="cross">âœ— å¼ºåˆ¶ä¸º0</td>
                    <td>Hilbertã€å¾®åˆ†å™¨</td>
                </tr>
                <tr>
                    <td><strong>Type IV</strong></td>
                    <td>å¶æ•°</td>
                    <td>å¥‡å¯¹ç§°</td>
                    <td class="cross">âœ— å¼ºåˆ¶ä¸º0</td>
                    <td class="check">âœ“ æ— çº¦æŸ</td>
                    <td>é«˜é€šå¾®åˆ†å™¨</td>
                </tr>
            </tbody>
        </table>
        
        <div class="tip-box" style="margin-top: 20px;">
            <strong>è®¾è®¡å»ºè®®ï¼š</strong>å¦‚æœæ²¡æœ‰ç‰¹æ®Šéœ€æ±‚ï¼Œä¼˜å…ˆé€‰æ‹© <strong>Type I</strong>ï¼ˆå¥‡æ•°é•¿åº¦ + å¶å¯¹ç§°ï¼‰ï¼Œå› ä¸ºå®ƒæ²¡æœ‰ä»»ä½•é¢‘ç‡é™åˆ¶ï¼Œè®¾è®¡çµæ´»åº¦æœ€é«˜ã€‚
        </div>
    </div>

</div>

<script>
    // ==========================================
    // é€»è¾‘éƒ¨åˆ† 1: äº¤äº’å®éªŒå®¤ (Stem Canvas)
    // ==========================================
    const cvs = document.getElementById('stemCanvas');
    const ctx = cvs.getContext('2d');
    const sliderN = document.getElementById('sliderN');
    const valN = document.getElementById('valN');
    const valOrder = document.getElementById('valOrder');
    
    // çŠ¶æ€å˜é‡
    let N = 11;
    let isSymmetric = true; // true = even symmetric, false = odd symmetric (antisymmetric)
    let h = [];
    let dragIdx = -1;

    // åˆå§‹åŒ–æ•°ç»„ h
    function resetH() {
        h = new Array(N).fill(0).map((_, i) => {
            // ç”Ÿæˆä¸€ä¸ªæ¼‚äº®çš„ sinc å½¢çŠ¶ä½œä¸ºåˆå§‹å€¼
            let x = (i - (N-1)/2);
            if(x === 0) return isSymmetric ? 0.8 : 0; // åå¯¹ç§°ä¸­å¿ƒå¿…ä¸º0
            if(!isSymmetric) return Math.sin(x)/x * (x>0 ? -1 : 1) * 0.5; // ç®€å•çš„åå¯¹ç§°å½¢çŠ¶
            return Math.sin(x/2)/(x/2) * 0.5;
        });
        enforceSymmetry();
    }

    // å¼ºåˆ¶æ‰§è¡Œå¯¹ç§°æ€§é€»è¾‘
    function enforceSymmetry() {
        const center = (N - 1) / 2;
        // ä¿®æ­£ï¼šå¦‚æœæ˜¯åˆšåˆ‡æ¢æ¨¡å¼ï¼Œéœ€è¦é‡æ–°è®¡ç®—å³åŠéƒ¨åˆ†
        for(let i=0; i < N/2; i++) {
            let val = h[i];
            let mirrorIdx = N - 1 - i;
            if(isSymmetric) {
                h[mirrorIdx] = val;
            } else {
                h[mirrorIdx] = -val;
            }
        }
        
        // ç‰¹æ®Šæƒ…å†µï¼šå¥‡æ•°é•¿åº¦ & åå¯¹ç§° => ä¸­å¿ƒç‚¹å½’é›¶
        if(!isSymmetric && N % 2 !== 0) {
            h[(N-1)/2] = 0;
        }
    }

    function draw() {
        // è‡ªé€‚åº”å®½åº¦
        cvs.width = cvs.clientWidth;
        cvs.height = cvs.clientHeight;
        const w = cvs.width;
        const hH = cvs.height;
        const margin = 40;
        const contentW = w - margin*2;
        const spacing = contentW / (N > 1 ? N-1 : 1);
        const zeroY = hH / 2;
        const scaleY = hH / 2.5; // ç•™ç‚¹ä½™é‡

        ctx.clearRect(0,0,w,hH);

        // è½´çº¿
        ctx.beginPath(); ctx.strokeStyle='#ccc'; 
        ctx.moveTo(margin, zeroY); ctx.lineTo(w-margin, zeroY); ctx.stroke();

        // å¯¹ç§°ä¸­å¿ƒçº¿
        ctx.beginPath(); ctx.setLineDash([5,5]); ctx.strokeStyle='#ddd';
        ctx.moveTo(w/2, 20); ctx.lineTo(w/2, hH-20); ctx.stroke(); ctx.setLineDash([]);

        // ç»˜åˆ¶ Stem
        for(let i=0; i<N; i++) {
            let x = margin + i*spacing;
            let y = zeroY - h[i]*scaleY;
            
            // é¢œè‰²é€»è¾‘
            let isLeft = i < (N-1)/2;
            let color = isLeft ? '#3498db' : (i === (N-1)/2 && N%2!==0 ? '#2c3e50' : '#e74c3c');
            if (!isLeft && !(i === (N-1)/2 && N%2!==0)) color = '#e74c3c'; // å³ä¾§è®¾ä¸ºçº¢è‰²

            ctx.beginPath(); ctx.lineWidth=2; ctx.strokeStyle=color;
            ctx.moveTo(x, zeroY); ctx.lineTo(x, y); ctx.stroke();

            ctx.beginPath(); ctx.arc(x, y, 5, 0, Math.PI*2); ctx.fillStyle=color; ctx.fill();
            
            // ç´¢å¼•æ–‡å­—
            ctx.fillStyle='#999'; ctx.font='10px Arial'; ctx.textAlign='center';
            ctx.fillText(i, x, zeroY + 15);
        }
    }

    // äº¤äº’äº‹ä»¶
    cvs.addEventListener('mousedown', e => {
        const rect = cvs.getBoundingClientRect();
        const mx = e.clientX - rect.left;
        const my = e.clientY - rect.top;
        
        const w = cvs.width;
        const margin = 40;
        const contentW = w - margin*2;
        const spacing = contentW / (N > 1 ? N-1 : 1);
        const zeroY = cvs.height / 2;
        const scaleY = cvs.height / 2.5;

        // å¯»æ‰¾æœ€è¿‘çš„ç‚¹
        let minD = 100;
        let idx = -1;

        for(let i=0; i<N; i++) {
            // åªèƒ½æ‹–åŠ¨å·¦åŠéƒ¨åˆ†
            if (i > (N-1)/2) continue;
            // å¦‚æœæ˜¯åå¯¹ç§°ä¸”å¥‡æ•°é•¿åº¦ï¼Œä¸­å¿ƒç‚¹ä¸èƒ½æ‹–åŠ¨
            if (!isSymmetric && N%2!==0 && i === (N-1)/2) continue;

            let x = margin + i*spacing;
            let y = zeroY - h[i]*scaleY;
            let d = Math.sqrt((mx-x)**2 + (my-y)**2);
            if(d < 15 && d < minD) {
                minD = d;
                idx = i;
            }
        }
        
        if(idx !== -1) {
            dragIdx = idx;
        }
    });

    window.addEventListener('mousemove', e => {
        if(dragIdx === -1) return;
        const rect = cvs.getBoundingClientRect();
        const my = e.clientY - rect.top;
        const zeroY = cvs.height / 2;
        const scaleY = cvs.height / 2.5;

        let val = -(my - zeroY) / scaleY;
        // Clamp
        if(val > 1.2) val = 1.2;
        if(val < -1.2) val = -1.2;

        h[dragIdx] = val;
        
        // æ›´æ–°é•œåƒç‚¹
        let mirrorIdx = N - 1 - dragIdx;
        if(mirrorIdx !== dragIdx) {
            h[mirrorIdx] = isSymmetric ? val : -val;
        }
        
        draw();
    });

    window.addEventListener('mouseup', () => dragIdx = -1);

    // æ§ä»¶å“åº”
    function setMode(mode) {
        isSymmetric = (mode === 'sym');
        document.getElementById('btnSym').className = isSymmetric ? 'toggle-btn active' : 'toggle-btn';
        document.getElementById('btnAnti').className = !isSymmetric ? 'toggle-btn active' : 'toggle-btn';
        
        // æ›´æ–°æè¿°æ–‡æœ¬å’Œå…¬å¼
        const descEl = document.getElementById('symDesc');
        if(isSymmetric) {
            descEl.innerHTML = `$$h[n] = h[N-1-n]$$<div style="margin-top:5px; font-size:0.8rem">ç›¸ä½æ–œç‡æ’å®š</div>`;
        } else {
            descEl.innerHTML = `$$h[n] = -h[N-1-n]$$<div style="margin-top:5px; font-size:0.8rem">ç›¸ä½åç§»90åº¦ï¼Œä¸­å¿ƒå¿…ä¸º0</div>`;
        }
        
        // å…³é”®ï¼šæ‰‹åŠ¨è§¦å‘ MathJax æ¸²æŸ“æ›´æ–°åçš„å…¬å¼
        if(window.MathJax) {
            MathJax.typesetPromise([descEl]);
        }

        enforceSymmetry();
        draw();
    }

    sliderN.addEventListener('input', e => {
        N = parseInt(e.target.value);
        valN.innerText = N;
        valOrder.innerText = N - 1;
        resetH(); 
        draw();
    });

    // åˆå§‹åŒ–
    resetH();
    draw();


    // ==========================================
    // é€»è¾‘éƒ¨åˆ† 2 & 3: ç±»å‹è¯¦æƒ…ä¸åŠ¨æ€å±•ç¤º
    // ==========================================
    
    // æ•°æ®åº“ - ä¿®æ­£äº†ä½¿ç”¨ ** åŠ ç²—çš„é—®é¢˜ï¼Œæ”¹ç”¨ <strong> æ ‡ç­¾
    const typeData = {
        1: {
            title: "Type I (Nå¥‡, å¶å¯¹ç§°)",
            math: "$$ H(\\omega) = e^{-j\\omega \\frac{N-1}{2}} \\sum_{n=0}^{(N-1)/2} a[n] \\cos(\\omega n) $$",
            plain: "è¿™æ˜¯æœ€å®Œç¾çš„ç±»å‹ã€‚<strong>æ²¡æœ‰ä»»ä½•å¼ºåˆ¶é›¶ç‚¹</strong>ã€‚ä½ å¯ä»¥ç”¨å®ƒè®¾è®¡ä½é€šã€é«˜é€šã€å¸¦é€šã€å¸¦é˜»ç­‰ä»»ä½•æ»¤æ³¢å™¨ã€‚å®ƒæ˜¯ FIR è®¾è®¡ä¸­çš„ä¸‡é‡‘æ²¹ã€‚",
            tags: ["ä½é€š OK", "é«˜é€š OK", "å¸¦é€š OK"],
            drawFreq: (ctx, w, h) => {
                ctx.beginPath(); ctx.moveTo(0, h*0.2); 
                ctx.bezierCurveTo(w*0.5, h*0.2, w*0.6, h*0.9, w, h*0.9);
                ctx.strokeStyle="#27ae60"; ctx.lineWidth=3; ctx.stroke();
                ctx.fillStyle="#27ae60"; ctx.font="bold 12px Arial";
                ctx.fillText("æ— å›ºå®šé›¶ç‚¹ï¼Œè‡ªç”±è®¾è®¡", w/4, h/2);
            }
        },
        2: {
            title: "Type II (Nå¶, å¶å¯¹ç§°)",
            math: "$$ H(\\omega) = e^{-j\\omega \\frac{N-1}{2}} \\sum_{n=1}^{N/2} b[n] \\cos[\\omega(n-1/2)] $$",
            plain: "æ³¨æ„çœ‹å…¬å¼é‡Œçš„ $\\cos[\\omega(n-1/2)]$ã€‚å½“é¢‘ç‡ $\\omega=\\pi$ æ—¶ï¼Œè¿™é‡Œå˜æˆäº† $\\cos(\\text{åŠå¥‡æ•°}\\cdot\\pi)$ï¼Œç»“æœæ°¸è¿œæ˜¯ 0ï¼<br><br>è¿™æ„å‘³ç€ï¼š<strong>ä½ åœ¨æœ€é«˜é¢‘ $\\pi$ å¤„è¢«å¼ºåˆ¶é™éŸ³äº†</strong>ã€‚æ‰€ä»¥å®ƒç»å¯¹<strong>ä¸èƒ½</strong>ç”¨æ¥åšé«˜é€šæ»¤æ³¢å™¨ã€‚",
            tags: ["ä½é€š OK", "é«˜é€š NO (å¼ºåˆ¶é›¶ç‚¹)", "å¸¦é€š OK"],
            drawFreq: (ctx, w, h) => {
                ctx.beginPath(); ctx.moveTo(0, h*0.2); 
                ctx.bezierCurveTo(w*0.5, h*0.2, w*0.8, h*0.9, w, h*0.9);
                ctx.strokeStyle="#e67e22"; ctx.lineWidth=3; ctx.stroke();
                drawRedDot(ctx, w, h*0.9, "Ï€ (å¼ºåˆ¶ä¸º0)");
            }
        },
        3: {
            title: "Type III (Nå¥‡, å¥‡å¯¹ç§°)",
            math: "$$ H(\\omega) = e^{-j[\\omega \\frac{N-1}{2} - \\frac{\\pi}{2}]} \\sum_{n=1}^{(N-1)/2} c[n] \\sin(\\omega n) $$",
            plain: "è¿™æ˜¯ä¸€ä¸ªæ‚²å‰§çš„ç±»å‹ã€‚$\\sin(\\omega n)$ å¯¼è‡´å®ƒåœ¨ $\\omega=0$ï¼ˆç›´æµï¼‰å¤„ä¸º 0ï¼›åŒæ—¶å› ä¸ºå¥‡å¯¹ç§°+å¥‡æ•°é•¿åº¦ï¼Œå®ƒåœ¨ $\\pi$ å¤„ä¹Ÿä¸º 0ã€‚<br><br><strong>ä¸¤å¤´éƒ½è¢«å µæ­»äº†</strong>ï¼å®ƒåªèƒ½è®©ä¸­é—´é¢‘ç‡é€šè¿‡ã€‚é€šå¸¸åªç”¨äºåš <strong>Hilbert å˜æ¢å™¨</strong>æˆ–å¾®åˆ†å™¨ã€‚",
            tags: ["ä½é€š NO", "é«˜é€š NO", "å¸¦é€š Only"],
            drawFreq: (ctx, w, h) => {
                ctx.beginPath(); ctx.moveTo(0, h*0.9); 
                ctx.quadraticCurveTo(w/2, h*0.1, w, h*0.9);
                ctx.strokeStyle="#e74c3c"; ctx.lineWidth=3; ctx.stroke();
                drawRedDot(ctx, 0, h*0.9, "DC=0");
                drawRedDot(ctx, w, h*0.9, "Ï€=0");
            }
        },
        4: {
            title: "Type IV (Nå¶, å¥‡å¯¹ç§°)",
            math: "$$ H(\\omega) = e^{-j[\\omega \\frac{N-1}{2} - \\frac{\\pi}{2}]} \\sum_{n=1}^{N/2} d[n] \\sin[\\omega(n-1/2)] $$",
            plain: "å› ä¸º $\\sin$ çš„å­˜åœ¨ï¼Œç›´æµï¼ˆ$\\omega=0$ï¼‰å¤„å¿…ç„¶ä¸º 0ã€‚æ‰€ä»¥<strong>ä¸èƒ½åšä½é€š</strong>ã€‚<br><br>ä½†åœ¨é«˜é¢‘ $\\pi$ å¤„å®ƒæ²¡æœ‰é™åˆ¶ã€‚å› æ­¤å®ƒéå¸¸é€‚åˆåš<strong>é«˜é€šå¾®åˆ†å™¨</strong>æˆ–å¸Œå°”ä¼¯ç‰¹å˜æ¢å™¨ã€‚",
            tags: ["ä½é€š NO (DC=0)", "é«˜é€š OK", "å¾®åˆ†å™¨ OK"],
            drawFreq: (ctx, w, h) => {
                ctx.beginPath(); ctx.moveTo(0, h*0.9); 
                ctx.bezierCurveTo(w*0.3, h*0.9, w*0.5, h*0.2, w, h*0.2);
                ctx.strokeStyle="#8e44ad"; ctx.lineWidth=3; ctx.stroke();
                drawRedDot(ctx, 0, h*0.9, "DC=0");
            }
        }
    };

    function drawRedDot(ctx, x, y, text) {
        ctx.fillStyle = "rgba(231, 76, 60, 0.2)";
        ctx.beginPath(); ctx.arc(x, y, 10, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = "#c0392b";
        ctx.beginPath(); ctx.arc(x, y, 4, 0, Math.PI*2); ctx.fill();
        ctx.font = "bold 12px Arial";
        ctx.textAlign = (x < 20) ? "left" : "right";
        ctx.fillText(text, (x < 20) ? x+15 : x-15, y);
    }

    function selectType(id) {
        for(let i=1; i<=4; i++) document.getElementById(`card${i}`).classList.remove('selected');
        document.getElementById(`card${id}`).classList.add('selected');

        const section = document.getElementById('detailSection');
        section.style.display = 'block';
        
        const data = typeData[id];
        document.getElementById('detailTitle').innerText = "è¯¦è§£ï¼š" + data.title;
        document.getElementById('mathContent').innerHTML = data.math;
        document.getElementById('plainText').innerHTML = data.plain;
        
        let tagsHtml = "";
        data.tags.forEach(t => {
            const cls = t.includes("NO") ? "tag-bad" : "tag-good";
            tagsHtml += `<span class="tag ${cls}">${t}</span>`;
        });
        document.getElementById('capabilities').innerHTML = tagsHtml;

        const fCvs = document.getElementById('freqCanvas');
        const fCtx = fCvs.getContext('2d');
        const w = fCvs.width;
        const h = fCvs.height;
        fCtx.clearRect(0,0,w,h);
        
        fCtx.beginPath(); fCtx.strokeStyle="#ddd"; 
        fCtx.moveTo(0, h*0.9); fCtx.lineTo(w, h*0.9); 
        fCtx.moveTo(0, 0); fCtx.lineTo(0, h); 
        fCtx.stroke();
        fCtx.fillStyle="#666"; fCtx.font="10px Arial";
        fCtx.fillText("0", 5, h*0.9 + 12);
        fCtx.fillText("Ï€", w-10, h*0.9 + 12);

        data.drawFreq(fCtx, w, h);

        if(window.MathJax) {
            // å¯¹åŠ¨æ€æ’å…¥çš„ä¸¤ä¸ªå®¹å™¨è¿›è¡Œæ¸²æŸ“
            MathJax.typesetPromise([
                document.getElementById('mathContent'),
                document.getElementById('plainText')
            ]);
        }
        
        section.scrollIntoView({behavior: "smooth", block: "nearest"});
    }

    // é¡µé¢åŠ è½½å®Œæˆåï¼Œé»˜è®¤é€‰ä¸­ Type I å¹¶æ˜¾ç¤ºå…¶è¯¦æƒ…
    window.addEventListener('load', () => {
        // ç­‰å¾… MathJax åŠ è½½å®Œæˆåå†åˆå§‹åŒ–
        setTimeout(() => {
            selectType(1);
        }, 500);
    });

</script>

</body>
</html>