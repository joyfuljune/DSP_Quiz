<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬ä¸ƒç« ï¼šFIR æ»¤æ³¢å™¨è®¾è®¡æµ‹éªŒ</title>
    
    <!-- åŠ è½½ MathJax -->
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            }
        };
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            /* ç¬¬ä¸ƒç« ä¸»é¢˜è‰²ï¼šé›è“/ç´«è‰²æ¸å˜ */
            background: linear-gradient(135deg, #4e4376 0%, #2b5876 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        /* å¼€å§‹ç•Œé¢æ ·å¼ */
        .start-screen {
            text-align: center;
            padding: 20px;
        }

        .info-form {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 30px;
            margin: 30px 0;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            color: #2c3e50;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #6c5ce7; /* ä¿®æ”¹èšç„¦é¢œè‰² */
        }

        .exam-info {
            background: #eef2f3;
            border-left: 4px solid #6c5ce7;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .exam-info h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .exam-info ul {
            margin-left: 20px;
            color: #34495e;
            line-height: 1.8;
        }

        .progress-bar {
            background: #ecf0f1;
            height: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            background: linear-gradient(90deg, #6c5ce7, #a29bfe);
            height: 100%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .question-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid #dee2e6;
            transition: all 0.3s;
        }

        .question-card.answered {
            border-color: #6c5ce7;
            background: #fdfcff;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .question-number {
            background: #4e4376;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .question-category {
            background: #95a5a6;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
        }
        
        /* é’ˆå¯¹ç¬¬ä¸ƒç« çš„åˆ†ç±»é¢œè‰² */
        .question-category.linear_phase { background: #3498db; }  /* çº¿æ€§ç›¸ä½ */
        .question-category.window { background: #27ae60; }     /* çª—å‡½æ•°æ³• */
        .question-category.freq_samp { background: #8e44ad; }  /* é¢‘ç‡é‡‡æ · */
        .question-category.calc { background: #e74c3c; }       /* è®¡ç®—ä¸ç»“æ„ */

        .question-text {
            font-size: 1.1em;
            color: #2c3e50;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .option:hover {
            background: #f8f9fa;
            border-color: #6c5ce7;
            transform: translateX(5px);
        }

        .option.selected {
            background: #eef2ff;
            border-color: #6c5ce7;
            border-width: 3px;
        }

        .option.correct {
            background: #d4edda;
            border-color: #28a745;
            border-width: 3px;
        }

        .option.incorrect {
            background: #f8d7da;
            border-color: #dc3545;
            border-width: 3px;
        }

        .option-label {
            background: #4e4376;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .option.correct .option-label { background: #28a745; }
        .option.incorrect .option-label { background: #dc3545; }
        .option-text { flex: 1; color: #2c3e50; }

        .explanation {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }

        .explanation.show { display: block; animation: slideDown 0.3s ease; }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .explanation h4 {
            color: #856404;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .explanation p { color: #856404; line-height: 1.6; }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-submit { background: #2b5876; color: white; }
        .btn-next { background: #6c5ce7; color: white; }
        .btn-prev { background: #95a5a6; color: white; }
        .btn-finish { background: #c0392b; color: white; }
        .btn-start { background: #6c5ce7; color: white; padding: 15px 50px; font-size: 1.2em; }

        .result-panel {
            background: linear-gradient(135deg, #4e4376 0%, #2b5876 100%);
            color: white;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            display: none;
        }

        .result-panel.show { display: block; animation: fadeIn 0.5s ease; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .student-info {
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            font-size: 1.2em;
        }

        .student-info p { margin: 5px 0; }
        .result-score { font-size: 4em; font-weight: bold; margin: 20px 0; }
        .result-message { font-size: 1.5em; margin-bottom: 20px; }
        .result-details { background: rgba(255,255,255,0.2); border-radius: 10px; padding: 20px; margin-top: 20px; }
        .result-details table { width: 100%; border-collapse: collapse; }
        .result-details td { padding: 10px; font-size: 1.1em; }
        .review-section { margin-top: 30px; }

        .review-question {
            background: white;
            color: #2c3e50;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
        }

        .review-status {
            padding: 5px 15px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.9em;
        }
        .review-status.correct { background: #d4edda; color: #155724; }
        .review-status.wrong { background: #f8d7da; color: #721c24; }
        .statistics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            color: #2c3e50;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .stat-value { font-size: 2em; font-weight: bold; margin: 10px 0; }
        .stat-label { color: #7f8c8d; font-size: 0.9em; }

        @media (max-width: 768px) {
            .container { padding: 20px; }
            h1 { font-size: 1.5em; }
            .button-group { flex-direction: column; }
            button { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ç¬¬ä¸ƒç« ï¼šFIR æ»¤æ³¢å™¨è®¾è®¡</h1>
        <p class="subtitle">å—äº¬å·¥ä¸šå¤§å­¦æµ¦æ±Ÿå­¦é™¢ | DSP - çª—å‡½æ•°ã€é¢‘ç‡é‡‡æ ·ä¸çº¿æ€§ç›¸ä½</p>

        <!-- å¼€å§‹ç•Œé¢ -->
        <div id="startScreen" class="start-screen">
            <div class="exam-info">
                <h3>ğŸ“‹ æµ‹éªŒè¯´æ˜</h3>
                <ul>
                    <li>å…±20é“é¢˜ç›®ï¼Œæ¶µç›–çº¿æ€§ç›¸ä½ç‰¹æ€§ã€çª—å‡½æ•°è®¾è®¡æ³•åŠé¢‘ç‡é‡‡æ ·æ³•</li>
                    <li>åŒ…å«é€‰æ‹©é¢˜ã€åˆ¤æ–­é¢˜ï¼ˆé€‰é¡¹å½¢å¼ï¼‰åŠå‚æ•°è®¡ç®—</li>
                    <li>æ‰€æœ‰é¢˜ç›®çš„é€‰é¡¹é¡ºåºå·²éšæœºåŒ–</li>
                    <li>æäº¤åå¯æŸ¥çœ‹è¯¦ç»†è§£æï¼Œè¯·ç»“åˆæ•™å­¦é¡µé¢å¤ä¹ </li>
                </ul>
            </div>

            <div class="info-form">
                <h3 style="color: #2c3e50; margin-bottom: 20px;">è¯·å¡«å†™ä½ çš„ä¿¡æ¯</h3>
                <div class="form-group">
                    <label for="studentId">å­¦å· <span style="color: red;">*</span></label>
                    <input type="text" id="studentId" placeholder="è¯·è¾“å…¥å­¦å·" required="">
                </div>
                <div class="form-group">
                    <label for="studentName">å§“å <span style="color: red;">*</span></label>
                    <input type="text" id="studentName" placeholder="è¯·è¾“å…¥å§“å" required="">
                </div>
                <button class="btn-start" onclick="startExam()">å¼€å§‹è€ƒè¯•</button>
            </div>
        </div>

        <!-- è€ƒè¯•ç•Œé¢ -->
        <div id="examScreen" style="display: none;">
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar">0/20 å·²å®Œæˆ</div>
            </div>

            <div id="questionContainer"></div>

            <div class="button-group">
                <button class="btn-prev" id="prevBtn" onclick="previousQuestion()">â¬…ï¸ ä¸Šä¸€é¢˜</button>
                <button class="btn-submit" id="submitBtn" onclick="submitAnswer()">âœ“ æäº¤ç­”æ¡ˆ</button>
                <button class="btn-next" id="nextBtn" onclick="nextQuestion()">ä¸‹ä¸€é¢˜ â¡ï¸</button>
                <button class="btn-finish" id="finishBtn" onclick="finishExam()" style="display: none;">ğŸ å®Œæˆè€ƒè¯•</button>
            </div>
        </div>

        <!-- ç»“æœç•Œé¢ -->
        <div class="result-panel" id="resultPanel">
            <h2>è€ƒè¯•å®Œæˆï¼</h2>
            
            <div class="student-info">
                <p><strong>å­¦å·ï¼š</strong><span id="resultStudentId"></span></p>
                <p><strong>å§“åï¼š</strong><span id="resultStudentName"></span></p>
            </div>

            <div class="result-score" id="resultScore">0/20</div>
            <div class="result-message" id="resultMessage"></div>
            
            <div class="statistics">
                <div class="stat-card">
                    <div class="stat-label">æ­£ç¡®ç‡</div>
                    <div class="stat-value" id="accuracyRate">0%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">çº¿æ€§ç›¸ä½</div>
                    <div class="stat-value" id="linearScore">0/6</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">çª—å‡½æ•°æ³•</div>
                    <div class="stat-value" id="windowScore">0/7</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">é¢‘ç‡é‡‡æ ·æ³•</div>
                    <div class="stat-value" id="freqSampScore">0/4</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ç»“æ„ä¸è®¡ç®—</div>
                    <div class="stat-value" id="calcScore">0/3</div>
                </div>
            </div>

            <button class="btn-submit" onclick="showReview()" style="margin-top: 30px;">ğŸ“ æŸ¥çœ‹è¯¦ç»†è§£æ</button>
            <button class="btn-next" onclick="location.reload()" style="margin-top: 10px;">ğŸ”„ é‡æ–°å¼€å§‹</button>
        </div>

        <div id="reviewSection" style="display: none;">
            <h2 style="margin: 30px 0 20px 0; color: #2c3e50;">ğŸ“š ç­”é¢˜å›é¡¾ä¸è§£æ</h2>
            <div id="reviewContainer"></div>
        </div>
    </div>

<script>
    // é¢˜ç›®åº“ - é’ˆå¯¹ Chapter 7 (FIRè®¾è®¡) å®šåˆ¶
    const originalQuestions = [
        // --- çº¿æ€§ç›¸ä½ (linear_phase) ---
        {
            id: 1,
            category: 'linear_phase',
            categoryName: 'çº¿æ€§ç›¸ä½',
            question: 'å¯¹äºä¸€ä¸ªé•¿åº¦ä¸º $N$ çš„ FIR æ»¤æ³¢å™¨ï¼Œè‹¥è¦ä¿è¯çº¿æ€§ç›¸ä½ç‰¹æ€§ï¼Œå…¶å•ä½è„‰å†²å“åº” $h[n]$ å¿…é¡»æ»¡è¶³ä»€ä¹ˆå¯¹ç§°æ¡ä»¶ï¼Ÿ',
            options: [
                '$h[n] = h[N-1-n]$ æˆ– $h[n] = -h[N-1-n]$',
                '$h[n] = h[N-n]$',
                '$h[n] = h[n-1]$',
                'ç³»æ•°å¿…é¡»å…¨éƒ¨ä¸ºæ­£æ•°'
            ],
            correct: 0,
            explanation: 'çº¿æ€§ç›¸ä½ FIR æ»¤æ³¢å™¨è¦æ±‚ $h[n]$ å…³äºä¸­å¿ƒç‚¹å¶å¯¹ç§°æˆ–å¥‡å¯¹ç§°ï¼Œå¯¹ç§°ä¸­å¿ƒä¸º $(N-1)/2$ã€‚'
        },
        {
            id: 2,
            category: 'linear_phase',
            categoryName: 'çº¿æ€§ç›¸ä½',
            question: 'Type II çº¿æ€§ç›¸ä½æ»¤æ³¢å™¨ï¼ˆé•¿åº¦ $N$ ä¸ºå¶æ•°ï¼Œå¶å¯¹ç§°ï¼‰åœ¨é¢‘ç‡å“åº”ä¸Šæœ‰ä¸€ä¸ªå¼ºåˆ¶çº¦æŸï¼Œè¿™ä½¿å¾—å®ƒ**ä¸èƒ½**ç”¨äºè®¾è®¡å“ªç§æ»¤æ³¢å™¨ï¼Ÿ',
            options: [
                'é«˜é€šæ»¤æ³¢å™¨',
                'ä½é€šæ»¤æ³¢å™¨',
                'å¸¦é€šæ»¤æ³¢å™¨',
                'å…¨é€šæ»¤æ³¢å™¨'
            ],
            correct: 0,
            explanation: 'Type II æ»¤æ³¢å™¨åœ¨ $\\omega=\\pi$ å¤„çš„å¹…åº¦å“åº”å¼ºåˆ¶ä¸º 0ï¼ˆå‚è§ fir-linear-phase-advanced.htmlï¼‰ï¼Œå› æ­¤é«˜é¢‘æˆåˆ†è¢«åˆ‡æ–­ï¼Œæ— æ³•ä½œä¸ºé«˜é€šæ»¤æ³¢å™¨ã€‚'
        },
        {
            id: 3,
            category: 'linear_phase',
            categoryName: 'çº¿æ€§ç›¸ä½',
            question: 'å¦‚æœéœ€è¦è®¾è®¡ä¸€ä¸ª **Hilbert å˜æ¢å™¨**ï¼ˆç›¸ç§» 90 åº¦ï¼‰ï¼Œåº”è¯¥é€‰æ‹©å“ªç§ç±»å‹çš„ FIR æ»¤æ³¢å™¨ï¼Ÿ',
            options: [
                'å¥‡å¯¹ç§° (Type III æˆ– IV)',
                'å¶å¯¹ç§° (Type I æˆ– II)',
                'éå¯¹ç§°',
                'æœ€å°ç›¸ä½ç³»ç»Ÿ'
            ],
            correct: 0,
            explanation: 'Hilbert å˜æ¢å™¨éœ€è¦ 90 åº¦çš„ç›¸ç§»ï¼Œå¯¹åº” $j$ æˆ– $-j$ï¼Œè¿™è¦æ±‚å¹…åº¦å“åº”åœ¨å®è½´ä¸Šè¡¨ç°ä¸ºçº¯è™šæ•°ç‰¹æ€§ï¼Œå¯¹åº”äºæ—¶åŸŸçš„å¥‡å¯¹ç§°ï¼ˆåå¯¹ç§°ï¼‰ç³»æ•°ã€‚'
        },
        {
            id: 4,
            category: 'linear_phase',
            categoryName: 'çº¿æ€§ç›¸ä½',
            question: 'é•¿åº¦ä¸º $N$ çš„çº¿æ€§ç›¸ä½ FIR æ»¤æ³¢å™¨çš„ç¾¤å»¶æ—¶ï¼ˆGroup Delayï¼‰ $\\tau_g$ æ˜¯å¤šå°‘ï¼Ÿ',
            options: [
                '$(N-1)/2$',
                '$N/2$',
                '$N$',
                '0'
            ],
            correct: 0,
            explanation: 'ç¾¤å»¶æ—¶æ˜¯ç›¸ä½æ–œç‡çš„è´Ÿæ•°ã€‚å¯¹äºå¯¹ç§°ä¸­å¿ƒåœ¨ $\\alpha = (N-1)/2$ çš„ FIRï¼Œå…¶ç›¸ä½ä¸º $-\\omega \\alpha$ï¼Œå› æ­¤ç¾¤å»¶æ—¶ä¸ºå¸¸æ•° $(N-1)/2$ã€‚'
        },
        {
            id: 5,
            category: 'linear_phase',
            categoryName: 'çº¿æ€§ç›¸ä½',
            question: 'Type III æ»¤æ³¢å™¨ï¼ˆé•¿åº¦ $N$ ä¸ºå¥‡æ•°ï¼Œå¥‡å¯¹ç§°ï¼‰åœ¨é¢‘ç‡ $\\omega=0$ å’Œ $\\omega=\\pi$ å¤„çš„å“åº”ç‰¹æ€§æ˜¯ï¼Ÿ',
            options: [
                'ä¸¤å¤„å¹…åº¦éƒ½å¿…é¡»ä¸º 0',
                'ä¸¤å¤„å¹…åº¦éƒ½ä¸èƒ½ä¸º 0',
                'åªæœ‰ $\\omega=0$ å¤„ä¸º 0',
                'åªæœ‰ $\\omega=\\pi$ å¤„ä¸º 0'
            ],
            correct: 0,
            explanation: 'Type III æ»¤æ³¢å™¨å› ä¸ºå¥‡å¯¹ç§°ï¼ˆ$\\sum h[n]=0$ï¼‰å¯¼è‡´ç›´æµå¢ç›Šä¸º0ï¼›å› ä¸ºé•¿åº¦ä¸ºå¥‡æ•°ä¸”å¥‡å¯¹ç§°ï¼Œå¯¼è‡´ $\\pi$ å¤„å¢ç›Šä¹Ÿä¸º0ã€‚åªèƒ½åšå¸¦é€šã€‚'
        },
        {
            id: 6,
            category: 'linear_phase',
            categoryName: 'çº¿æ€§ç›¸ä½',
            question: 'å“ªç§ç±»å‹çš„çº¿æ€§ç›¸ä½ FIR æ»¤æ³¢å™¨è¢«ç§°ä¸ºâ€œä¸‡èƒ½å‹â€ï¼Œæ²¡æœ‰å¼ºåˆ¶çš„é›¶ç‚¹çº¦æŸï¼Ÿ',
            options: [
                'Type I (é•¿åº¦ $N$ å¥‡æ•°ï¼Œå¶å¯¹ç§°)',
                'Type II (é•¿åº¦ $N$ å¶æ•°ï¼Œå¶å¯¹ç§°)',
                'Type III (é•¿åº¦ $N$ å¥‡æ•°ï¼Œå¥‡å¯¹ç§°)',
                'Type IV (é•¿åº¦ $N$ å¶æ•°ï¼Œå¥‡å¯¹ç§°)'
            ],
            correct: 0,
            explanation: 'Type I æ»¤æ³¢å™¨åœ¨ 0 å’Œ $\\pi$ å¤„éƒ½æ²¡æœ‰å¼ºåˆ¶é›¶ç‚¹ï¼Œå¯ä»¥è®¾è®¡ä½é€šã€é«˜é€šã€å¸¦é€šã€å¸¦é˜»ç­‰ä»»æ„ç±»å‹ã€‚'
        },

        // --- çª—å‡½æ•°æ³• (window) ---
        {
            id: 7,
            category: 'window',
            categoryName: 'çª—å‡½æ•°æ³•',
            question: 'åœ¨çª—å‡½æ•°æ³•è®¾è®¡ä¸­ï¼Œ**å‰å¸ƒæ–¯ç°è±¡ï¼ˆGibbs Phenomenonï¼‰**æ˜¯æŒ‡ï¼Ÿ',
            options: [
                'é€šå¸¦å’Œé˜»å¸¦è¾¹ç¼˜å‡ºç°çš„æ³¢çº¹ï¼Œä¸”ä¸éš N å¢å¤§è€Œæ¶ˆå¤±',
                'æ»¤æ³¢å™¨ç›¸ä½å‘ç”Ÿéçº¿æ€§å¤±çœŸ',
                'æ»¤æ³¢å™¨ç³»æ•°å˜ä¸ºå¤æ•°',
                'è¿‡æ¸¡å¸¦å®½åº¦æ— é™å˜çª„'
            ],
            correct: 0,
            explanation: 'å‰å¸ƒæ–¯ç°è±¡æ˜¯æˆªæ–­å‚…é‡Œå¶çº§æ•°å¯¼è‡´çš„ã€‚å¢åŠ é•¿åº¦ $N$ åªèƒ½å‹ç¼©æ³¢çº¹çš„é¢‘ç‡èŒƒå›´ï¼ˆä½¿è¿‡æ¸¡å¸¦å˜é™¡ï¼‰ï¼Œä½†æ³¢çº¹çš„æœ€å¤§å¹…åº¦ï¼ˆè¿‡å†²é‡ï¼‰ç”±çª—å‡½æ•°çš„ç±»å‹å†³å®šï¼Œä¸ä¼šéš $N$ å‡å°ã€‚'
        },
        {
            id: 8,
            category: 'window',
            categoryName: 'çª—å‡½æ•°æ³•',
            question: 'ä»¥ä¸‹å“ªç§çª—å‡½æ•°çš„ä¸»ç“£æœ€çª„ï¼ˆè¿‡æ¸¡å¸¦æœ€é™¡ï¼‰ï¼Œä½†æ—ç“£è¡°å‡æœ€å·®ï¼ˆé˜»å¸¦æ³¢çº¹å¤§ï¼‰ï¼Ÿ',
            options: [
                'çŸ©å½¢çª— (Rectangular)',
                'æ±‰å®çª— (Hanning)',
                'æ±‰æ˜çª— (Hamming)',
                'å¸ƒè±å…‹æ›¼çª— (Blackman)'
            ],
            correct: 0,
            explanation: 'çŸ©å½¢çª—ç›´æ¥æˆªæ–­ï¼Œé¢‘è°±ä¸»ç“£æœ€çª„ï¼ˆ$4\\pi/N$ï¼‰ï¼Œä½†æ—ç“£ç”µå¹³æœ€é«˜ï¼ˆ-13dBï¼‰ï¼Œé˜»å¸¦æ€§èƒ½æœ€å·®ã€‚'
        },
        {
            id: 9,
            category: 'window',
            categoryName: 'çª—å‡½æ•°æ³•',
            question: 'å¦‚æœè®¾è®¡æŒ‡æ ‡è¦æ±‚é˜»å¸¦è¡°å‡è‡³å°‘è¾¾åˆ° **50dB**ï¼Œæ ¹æ®ç»éªŒå…¬å¼ï¼Œåº”é€‰æ‹©å“ªç§çª—å‡½æ•°ï¼Ÿ',
            options: [
                'æ±‰æ˜çª— (Hamming, ~-53dB) æˆ– å¸ƒè±å…‹æ›¼çª—',
                'çŸ©å½¢çª— (~-21dB)',
                'æ±‰å®çª— (~-44dB)',
                'ä»»ä½•çª—å‡½æ•°éƒ½å¯ä»¥'
            ],
            correct: 0,
            explanation: 'çŸ©å½¢çª—åªèƒ½æä¾›çº¦ 21dB è¡°å‡ï¼Œæ±‰å®çª—çº¦ 44dBï¼Œæ±‰æ˜çª—çº¦ 53dBï¼Œå¸ƒè±å…‹æ›¼çª—çº¦ 74dBã€‚æ»¡è¶³ >50dB éœ€é€‰æ±‰æ˜æˆ–å¸ƒè±å…‹æ›¼ã€‚'
        },
        {
            id: 10,
            category: 'window',
            categoryName: 'çª—å‡½æ•°æ³•',
            question: 'çª—å‡½æ•°æ³•è®¾è®¡ FIR æ»¤æ³¢å™¨çš„æ—¶åŸŸç³»æ•° $h[n]$ çš„è®¡ç®—å…¬å¼æ˜¯ï¼Ÿ',
            options: [
                '$h[n] = h_{ideal}[n] \\cdot w[n]$',
                '$h[n] = h_{ideal}[n] * w[n]$ (å·ç§¯)',
                '$h[n] = h_{ideal}[n] + w[n]$',
                '$h[n] = DFT[ H_{ideal}(k) ]$'
            ],
            correct: 0,
            explanation: 'çª—å‡½æ•°æ³•åœ¨æ—¶åŸŸä¸Šä½“ç°ä¸ºç†æƒ³æ— é™é•¿è„‰å†²å“åº” $h_{ideal}$ ä¸æœ‰é™é•¿çª—å‡½æ•° $w[n]$ çš„**ä¹˜ç§¯**ã€‚'
        },
        {
            id: 11,
            category: 'window',
            categoryName: 'çª—å‡½æ•°æ³•',
            question: 'å¯¹äºä½é€šæ»¤æ³¢å™¨ï¼Œè‹¥è¿‡æ¸¡å¸¦å®½åº¦ $\\Delta\\omega$ ç»™å®šï¼Œæ»¤æ³¢å™¨é•¿åº¦ $N$ ä¸ $\\Delta\\omega$ å¤§è‡´æˆä»€ä¹ˆå…³ç³»ï¼Ÿ',
            options: [
                'åæ¯” ($N \\propto 1/\\Delta\\omega$)',
                'æ­£æ¯” ($N \\propto \\Delta\\omega$)',
                'å¹³æ–¹å…³ç³»',
                'æ— å…³'
            ],
            correct: 0,
            explanation: 'è¿‡æ¸¡å¸¦å®½åº¦ç”±çª—å‡½æ•°çš„ä¸»ç“£å®½åº¦å†³å®šï¼Œä¸»ç“£å®½åº¦é€šå¸¸ä¸º $C/N$ã€‚å› æ­¤ $\\Delta\\omega \\approx C/N$ï¼Œå³ $N \\approx C/\\Delta\\omega$ã€‚è¿‡æ¸¡å¸¦è¶Šçª„ï¼Œæ‰€éœ€é˜¶æ•°è¶Šé«˜ã€‚'
        },
        {
            id: 12,
            category: 'window',
            categoryName: 'çª—å‡½æ•°æ³•',
            question: 'ä¸ºä»€ä¹ˆç†æƒ³ä½é€šæ»¤æ³¢å™¨çš„ $h_{ideal}[n]$ æ˜¯ $sinc$ å‡½æ•°å½¢å¼ï¼Ÿ',
            options: [
                'å› ä¸ºé¢‘åŸŸçŸ©å½¢å‡½æ•°çš„å‚…é‡Œå¶é€†å˜æ¢æ˜¯ $sinc$ å‡½æ•°',
                'å› ä¸ºçª—å‡½æ•°æ˜¯ $sinc$ å‡½æ•°',
                'ä¸ºäº†ä¿è¯å› æœæ€§',
                'è¿™æ˜¯äººä¸ºè§„å®šçš„'
            ],
            correct: 0,
            explanation: 'ç†æƒ³ä½é€šæ»¤æ³¢å™¨çš„é¢‘åŸŸæ˜¯çŸ©å½¢çª—ï¼ˆé—¨å‡½æ•°ï¼‰ã€‚æ ¹æ®å‚…é‡Œå¶å˜æ¢å¯¹ï¼Œé¢‘åŸŸçš„çŸ©å½¢å¯¹åº”æ—¶åŸŸçš„ $Sa(t)$ æˆ–ç¦»æ•£åŸŸçš„ $sinc$ å‡½æ•°ã€‚'
        },
        {
            id: 13,
            category: 'window',
            categoryName: 'çª—å‡½æ•°æ³•',
            question: 'Blackman çª—ç›¸æ¯”äº Hamming çª—ï¼Œä¸»è¦ä¼˜åŠ¿å’ŒåŠ£åŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ',
            options: [
                'ä¼˜åŠ¿ï¼šé˜»å¸¦è¡°å‡æ›´å¤§ï¼›åŠ£åŠ¿ï¼šè¿‡æ¸¡å¸¦æ›´å®½',
                'ä¼˜åŠ¿ï¼šè¿‡æ¸¡å¸¦æ›´çª„ï¼›åŠ£åŠ¿ï¼šé˜»å¸¦è¡°å‡æ›´å°',
                'ä¼˜åŠ¿ï¼šè®¡ç®—ç®€å•ï¼›åŠ£åŠ¿ï¼šç›¸ä½éçº¿æ€§',
                'ä¸¤è€…æ€§èƒ½å®Œå…¨ç›¸åŒ'
            ],
            correct: 0,
            explanation: 'Blackman çª—å…·æœ‰æä½çš„æ—ç“£ï¼ˆ-74dBï¼‰ï¼Œä½†ä»£ä»·æ˜¯ä¸»ç“£å®½åº¦å¢åŠ ï¼ˆ$12\\pi/N$ï¼‰ï¼Œå¯¼è‡´ç›¸åŒ $N$ ä¸‹è¿‡æ¸¡å¸¦æ¯” Hamming çª—ï¼ˆ$8\\pi/N$ï¼‰æ›´å®½ã€‚'
        },

        // --- é¢‘ç‡é‡‡æ ·æ³• (freq_samp) ---
        {
            id: 14,
            category: 'freq_samp',
            categoryName: 'é¢‘ç‡é‡‡æ ·æ³•',
            question: 'é¢‘ç‡é‡‡æ ·æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ç›´æ¥æ§åˆ¶æ»¤æ³¢å™¨çš„ï¼Ÿ',
            options: [
                'é¢‘åŸŸä¸Šçš„ç¦»æ•£é‡‡æ ·ç‚¹å€¼ $H(k)$',
                'æ—¶åŸŸä¸Šçš„å†²æ¿€å“åº”å€¼ $h[n]$',
                'Z å¹³é¢ä¸Šçš„æç‚¹ä½ç½®',
                'è¾“å…¥ä¿¡å·çš„å¹…åº¦'
            ],
            correct: 0,
            explanation: 'é¢‘ç‡é‡‡æ ·æ³•é€šè¿‡è®¾å®š $0 \\sim 2\\pi$ åŒºé—´å†… $N$ ä¸ªç­‰é—´éš”é¢‘ç‡ç‚¹çš„å¹…åº¦å’Œç›¸ä½å€¼ï¼Œç„¶ååš IDFT å¾—åˆ° $h[n]$ã€‚'
        },
        {
            id: 15,
            category: 'freq_samp',
            categoryName: 'é¢‘ç‡é‡‡æ ·æ³•',
            question: 'åœ¨é¢‘ç‡é‡‡æ ·æ³•ä¸­ï¼Œä¸ºäº†å‡å°é€šå¸¦å’Œé˜»å¸¦äº¤ç•Œå¤„çš„**é€¼è¿‘è¯¯å·®ï¼ˆæ³¢çº¹ï¼‰**ï¼Œé€šå¸¸é‡‡å–ä»€ä¹ˆæªæ–½ï¼Ÿ',
            options: [
                'è®¾ç½® 1~2 ä¸ªè¿‡æ¸¡å¸¦é‡‡æ ·ç‚¹ï¼ˆå¦‚ 0.5, 0.2 ç­‰ï¼‰',
                'å°†é‡‡æ ·ç‚¹æ•° $N$ è®¾ä¸ºå¶æ•°',
                'å¼ºåˆ¶ç›¸ä½ä¸ºé›¶',
                'ä½¿ç”¨çŸ©å½¢çª—æˆªæ–­'
            ],
            correct: 0,
            explanation: 'ç›´æ¥ä» 1 è·³å˜åˆ° 0 ä¼šå¯¼è‡´å‰§çƒˆçš„å‰å¸ƒæ–¯æ³¢çº¹ã€‚åœ¨é€šå¸¦å’Œé˜»å¸¦ä¹‹é—´å¼•å…¥ä¸­é—´å€¼ï¼ˆè¿‡æ¸¡é‡‡æ ·ç‚¹ï¼‰å¯ä»¥ä½¿é¢‘ç‡å“åº”æ›²çº¿å˜åŒ–æ›´å¹³ç¼“ï¼Œä»è€Œå‡å°æ—ç“£æ³¢çº¹ï¼ˆå‚è§ freq-samp-method.html å®éªŒï¼‰ã€‚'
        },
        {
            id: 16,
            category: 'freq_samp',
            categoryName: 'é¢‘ç‡é‡‡æ ·æ³•',
            question: 'ä¸ºäº†ä¿è¯é€šè¿‡é¢‘ç‡é‡‡æ ·æ³•å¾—åˆ°çš„ $h[n]$ æ˜¯**å®æ•°**åºåˆ—ï¼Œé¢‘åŸŸé‡‡æ ·å€¼ $H(k)$ å¿…é¡»æ»¡è¶³ï¼Ÿ',
            options: [
                'å…±è½­å¯¹ç§°æ€§ $H(k) = H^*(N-k)$',
                'å¶å¯¹ç§°æ€§ $H(k) = H(N-k)$',
                'å®æ•°æ€§ï¼ˆè™šéƒ¨ä¸º0ï¼‰',
                'å…¨ 1 åºåˆ—'
            ],
            correct: 0,
            explanation: 'æ—¶åŸŸä¸ºå®æ•°ï¼Œå¯¹åº”é¢‘åŸŸï¼ˆDFTï¼‰å…·æœ‰å…±è½­å¯¹ç§°æ€§ã€‚å¹…åº¦å…³äºä¸­å¿ƒå¶å¯¹ç§°ï¼Œç›¸ä½å…³äºä¸­å¿ƒå¥‡å¯¹ç§°ã€‚'
        },
        {
            id: 17,
            category: 'freq_samp',
            categoryName: 'é¢‘ç‡é‡‡æ ·æ³•',
            question: 'ä¸çª—å‡½æ•°æ³•ç›¸æ¯”ï¼Œé¢‘ç‡é‡‡æ ·æ³•çš„ä¸€ä¸ªä¸»è¦ç¼ºç‚¹æ˜¯ï¼Ÿ',
            options: [
                'é‡‡æ ·ç‚¹ä¹‹é—´çš„é¢‘ç‡å“åº”éš¾ä»¥ç²¾ç¡®æ§åˆ¶ï¼ˆé™¤éå¢åŠ è¿‡æ¸¡ç‚¹ï¼‰',
                'è®¡ç®—é‡æ— é™å¤§',
                'æ— æ³•å®ç°çº¿æ€§ç›¸ä½',
                'åªèƒ½è®¾è®¡ä½é€šæ»¤æ³¢å™¨'
            ],
            correct: 0,
            explanation: 'è™½ç„¶åœ¨é‡‡æ ·ç‚¹ $k$ ä¸Šè¯¯å·®ä¸ºé›¶ï¼Œä½†åœ¨é‡‡æ ·ç‚¹ä¹‹é—´ï¼ˆInter-sampleï¼‰å¯èƒ½ä¼šå‡ºç°è¾ƒå¤§çš„æ³¢çº¹ï¼Œå¯¼è‡´é˜»å¸¦è¡°å‡ä¸å¦‚ä¼˜åŒ–åçš„çª—å‡½æ•°æ³•ï¼ˆå¦‚ Kaiser çª—ï¼‰å¥½ã€‚'
        },

        // --- ç»“æ„ä¸è®¡ç®— (calc) ---
        {
            id: 18,
            category: 'calc',
            categoryName: 'ç»“æ„ä¸è®¡ç®—',
            question: 'åˆ©ç”¨ FIR æ»¤æ³¢å™¨çš„çº¿æ€§ç›¸ä½å¯¹ç§°æ€§ï¼Œå¯ä»¥èŠ‚çœå¤šå°‘**ä¹˜æ³•å™¨**èµ„æºï¼Ÿ',
            options: [
                'çº¦ 50% (å‡åŠ)',
                'çº¦ 10%',
                '0%',
                '100% (ä¸éœ€è¦ä¹˜æ³•)'
            ],
            correct: 0,
            explanation: 'å› ä¸º $h[n] = \pm h[N-1-n]$ï¼Œå¯ä»¥å°†å¯¹ç§°çš„è¾“å…¥ä¿¡å·å…ˆç›¸åŠ ï¼ˆæˆ–ç›¸å‡ï¼‰ï¼Œå†ä¸åŒä¸€ä¸ªç³»æ•°ç›¸ä¹˜ã€‚è¿™ä½¿å¾—ä¹˜æ³•è¿ç®—é‡å‡å°‘äº†ä¸€åŠã€‚'
        },
        {
            id: 19,
            category: 'calc',
            categoryName: 'ç»“æ„ä¸è®¡ç®—',
            question: 'è®¡ç®—é¢˜ï¼šè‹¥è®¾è®¡ä¸€ä¸ªæˆªæ­¢é¢‘ç‡ä¸º $200\\text{Hz}$ çš„é«˜é€šæ»¤æ³¢å™¨ï¼Œé‡‡æ ·ç‡ä¸º $1000\\text{Hz}$ï¼Œåˆ™å½’ä¸€åŒ–æˆªæ­¢é¢‘ç‡ $\\omega_c$ ä¸ºï¼Ÿ',
            options: [
                '$0.4\\pi$',
                '$0.2\\pi$',
                '$0.5\\pi$',
                '$0.8\\pi$'
            ],
            correct: 0,
            explanation: 'å½’ä¸€åŒ–é¢‘ç‡ $\\omega = 2\\pi \\cdot (f / F_s) = 2\\pi \\cdot (200/1000) = 0.4\\pi$ã€‚'
        },
        {
            id: 20,
            category: 'calc',
            categoryName: 'ç»“æ„ä¸è®¡ç®—',
            question: 'FIR æ»¤æ³¢å™¨æ€»æ˜¯**ç¨³å®š**çš„ï¼Œå› ä¸ºï¼Ÿ',
            options: [
                'å…¶ç³»ç»Ÿå‡½æ•° $H(z)$ çš„æç‚¹å…¨éƒ¨åœ¨åŸç‚¹ $z=0$ (å•ä½åœ†å†…)',
                'å®ƒæ²¡æœ‰åé¦ˆå›è·¯',
                'å…¶å†²æ¿€å“åº”æ˜¯æœ‰é™é•¿çš„ï¼ˆç»å¯¹å¯å’Œï¼‰',
                'ä»¥ä¸Šå…¨å¯¹'
            ],
            correct: 3,
            explanation: 'FIR æ»¤æ³¢å™¨æ²¡æœ‰åé¦ˆï¼ˆéé€’å½’ï¼‰ï¼Œå…¶æç‚¹ä»…ä½äº $z=0$ï¼Œä¸” $h[n]$ æœ‰é™é•¿æ»¡è¶³ $\\sum |h[n]| < \\infty$ï¼Œå› æ­¤æ°¸è¿œæ˜¯ç¨³å®šçš„ã€‚'
        }
    ];

    // --- ä»¥ä¸‹é€»è¾‘ä»£ç ä¸ chp5_quiz.html ä¿æŒä¸€è‡´ï¼Œæ— éœ€ä¿®æ”¹ ---
    let questions = [];
    let currentQuestion = 0;
    let userAnswers = new Array(20).fill(null);
    let submitted = false;
    let studentInfo = { id: '', name: '' };

    function shuffleArray(array) {
        const newArray = [...array];
        for (let i = newArray.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
        }
        return newArray;
    }

    function shuffleQuestions() {
        questions = shuffleArray(originalQuestions).map(q => {
            const optionsWithIndex = q.options.map((option, index) => ({
                text: option,
                originalIndex: index
            }));
            const shuffledOptions = shuffleArray(optionsWithIndex);
            const newCorrectIndex = shuffledOptions.findIndex(
                opt => opt.originalIndex === q.correct
            );
            return {
                ...q,
                options: shuffledOptions.map(opt => opt.text),
                correct: newCorrectIndex
            };
        });
    }

    function startExam() {
        const studentId = document.getElementById('studentId').value.trim();
        const studentName = document.getElementById('studentName').value.trim();
        if (!studentId || !studentName) {
            alert('è¯·å¡«å†™å®Œæ•´çš„å­¦å·å’Œå§“åï¼');
            return;
        }
        studentInfo.id = studentId;
        studentInfo.name = studentName;
        shuffleQuestions();
        document.getElementById('startScreen').style.display = 'none';
        document.getElementById('examScreen').style.display = 'block';
        init();
    }

    function init() {
        displayQuestion();
        updateButtons();
        updateProgress();
    }

    function displayQuestion() {
        const q = questions[currentQuestion];
        const container = document.getElementById('questionContainer');
        let html = `
            <div class="question-card ${userAnswers[currentQuestion] !== null ? 'answered' : ''}">
                <div class="question-header">
                    <span class="question-number">ç¬¬ ${currentQuestion + 1} é¢˜</span>
                    <span class="question-category ${q.category}">${q.categoryName}</span>
                </div>
                <div class="question-text">${q.question}</div>
                <div class="options">`;

        q.options.forEach((option, index) => {
            const selected = userAnswers[currentQuestion] === index ? 'selected' : '';
            const label = String.fromCharCode(65 + index);
            html += `
                <div class="option ${selected}" onclick="selectOption(${index})">
                    <div class="option-label">${label}</div>
                    <div class="option-text">${option}</div>
                </div>`;
        });
        html += `</div><div class="explanation" id="explanation"></div></div>`;
        container.innerHTML = html;
        if (window.MathJax) {
            MathJax.typesetPromise([container]).catch((err) => console.log(err));
        }
    }

    function selectOption(index) {
        if (submitted) return;
        userAnswers[currentQuestion] = index;
        displayQuestion();
        updateProgress();
    }

    function submitAnswer() {
        if (userAnswers[currentQuestion] === null) {
            alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç­”æ¡ˆï¼');
            return;
        }
        const q = questions[currentQuestion];
        const userAnswer = userAnswers[currentQuestion];
        const isCorrect = userAnswer === q.correct;
        const options = document.querySelectorAll('.option');
        options.forEach((option, index) => {
            if (index === q.correct) {
                option.classList.add('correct');
            } else if (index === userAnswer && !isCorrect) {
                option.classList.add('incorrect');
            }
            option.style.pointerEvents = 'none';
        });
        const explanation = document.getElementById('explanation');
        const icon = isCorrect ? 'âœ“' : 'âœ—';
        const style = isCorrect ? 'color: #28a745;' : 'color: #dc3545;';
        explanation.innerHTML = `
            <h4><span style="${style}">${icon}</span> ${isCorrect ? 'å›ç­”æ­£ç¡®ï¼' : 'å›ç­”é”™è¯¯ï¼'}</h4>
            <p><strong>æ­£ç¡®ç­”æ¡ˆï¼š</strong>${String.fromCharCode(65 + q.correct)}</p>
            <p><strong>è§£æï¼š</strong>${q.explanation}</p>`;
        explanation.classList.add('show');
        if (window.MathJax) {
            MathJax.typesetPromise([explanation]).catch((err) => console.log(err));
        }
        document.getElementById('submitBtn').style.display = 'none';
        document.getElementById('nextBtn').style.display = 'inline-block';
        if (currentQuestion === questions.length - 1) {
            document.getElementById('finishBtn').style.display = 'inline-block';
            document.getElementById('nextBtn').style.display = 'none';
        }
    }

    function nextQuestion() {
        if (currentQuestion < questions.length - 1) {
            currentQuestion++;
            displayQuestion();
            updateButtons();
            window.scrollTo(0, 0);
        }
    }

    function previousQuestion() {
        if (currentQuestion > 0) {
            currentQuestion--;
            displayQuestion();
            updateButtons();
            window.scrollTo(0, 0);
        }
    }

    function updateButtons() {
        document.getElementById('prevBtn').disabled = currentQuestion === 0;
        document.getElementById('submitBtn').style.display = 'inline-block';
        document.getElementById('nextBtn').style.display = 'none';
        document.getElementById('finishBtn').style.display = 'none';
        
        if (document.querySelector('.explanation.show')) {
            document.getElementById('submitBtn').style.display = 'none';
            if (currentQuestion === questions.length - 1) {
                document.getElementById('finishBtn').style.display = 'inline-block';
            } else {
                document.getElementById('nextBtn').style.display = 'inline-block';
            }
        }
    }

    function updateProgress() {
        const answered = userAnswers.filter(a => a !== null).length;
        const progressBar = document.getElementById('progressBar');
        const percentage = (answered / questions.length) * 100;
        progressBar.style.width = percentage + '%';
        progressBar.textContent = `${answered}/${questions.length} å·²å®Œæˆ`;
    }

    function finishExam() {
        const unanswered = userAnswers.filter(a => a === null).length;
        if (unanswered > 0) {
            if (!confirm(`è¿˜æœ‰ ${unanswered} é¢˜æœªä½œç­”ï¼Œç¡®å®šè¦æäº¤å—ï¼Ÿ`)) {
                return;
            }
        }
        submitted = true;
        calculateResults();
        document.getElementById('examScreen').style.display = 'none';
        document.getElementById('resultPanel').classList.add('show');
    }

    function calculateResults() {
        let correctCount = 0;
        let categoryScores = {
            linear_phase: { correct: 0, total: 0 },
            window: { correct: 0, total: 0 },
            freq_samp: { correct: 0, total: 0 },
            calc: { correct: 0, total: 0 }
        };
        questions.forEach((q, index) => {
            const isCorrect = userAnswers[index] === q.correct;
            if (isCorrect) correctCount++;
            categoryScores[q.category].total++;
            if (isCorrect) categoryScores[q.category].correct++;
        });

        const percentage = (correctCount / questions.length * 100).toFixed(1);
        document.getElementById('resultStudentId').textContent = studentInfo.id;
        document.getElementById('resultStudentName').textContent = studentInfo.name;
        document.getElementById('resultScore').textContent = `${correctCount}/${questions.length}`;
        document.getElementById('accuracyRate').textContent = percentage + '%';
        let message = '';
        if (percentage >= 90) message = 'ğŸ‰ éå¸¸å‡ºè‰²ï¼ä½ å·²å®Œå…¨æŒæ¡ FIR æ»¤æ³¢å™¨è®¾è®¡ç²¾é«“ï¼';
        else if (percentage >= 80) message = 'ğŸ‘ è‰¯å¥½ï¼å¯¹çª—å‡½æ•°å’Œçº¿æ€§ç›¸ä½ç†è§£åˆ°ä½ã€‚';
        else if (percentage >= 70) message = 'âœ“ åŠæ ¼ï¼å»ºè®®å†å¤ä¹ ä¸€ä¸‹å››ç§çº¿æ€§ç›¸ä½ç±»å‹çš„çº¦æŸã€‚';
        else if (percentage >= 60) message = 'âš ï¸ åˆšåŠæ ¼ï¼Œè¯·é‡ç‚¹åŒºåˆ†çŸ©å½¢çª—å’Œæ±‰æ˜çª—çš„ç‰¹æ€§ï¼';
        else message = 'âŒ åŸºç¡€ä¸ç‰¢ï¼è¯·é‡æ–°é˜…è¯»äº¤äº’å¼æ•™å­¦ææ–™ã€‚';
        document.getElementById('resultMessage').textContent = message;
        
        document.getElementById('linearScore').textContent = `${categoryScores.linear_phase.correct}/${categoryScores.linear_phase.total}`;
        document.getElementById('windowScore').textContent = `${categoryScores.window.correct}/${categoryScores.window.total}`;
        document.getElementById('freqSampScore').textContent = `${categoryScores.freq_samp.correct}/${categoryScores.freq_samp.total}`;
        document.getElementById('calcScore').textContent = `${categoryScores.calc.correct}/${categoryScores.calc.total}`;
    }

    function showReview() {
        const reviewSection = document.getElementById('reviewSection');
        const reviewContainer = document.getElementById('reviewContainer');
        let html = '';
        questions.forEach((q, index) => {
            const userAnswer = userAnswers[index];
            const isCorrect = userAnswer === q.correct;
            const statusClass = isCorrect ? 'correct' : 'wrong';
            const statusText = isCorrect ? 'âœ“ æ­£ç¡®' : 'âœ— é”™è¯¯';
            html += `
                <div class="review-question">
                    <div class="review-header">
                        <div>
                            <span class="question-number">ç¬¬ ${index + 1} é¢˜</span>
                            <span class="question-category ${q.category}">${q.categoryName}</span>
                        </div>
                        <span class="review-status ${statusClass}">${statusText}</span>
                    </div>
                    <div class="question-text">${q.question}</div>
                    <div style="margin-top: 15px;">
                        <p><strong>ä½ çš„ç­”æ¡ˆï¼š</strong>${userAnswer !== null ? String.fromCharCode(65 + userAnswer) + '. ' + q.options[userAnswer] : 'æœªä½œç­”'}</p>
                        <p style="color: #28a745;"><strong>æ­£ç¡®ç­”æ¡ˆï¼š</strong>${String.fromCharCode(65 + q.correct)}. ${q.options[q.correct]}</p>
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin-top: 15px;">
                        <strong>ğŸ“– è§£æï¼š</strong>${q.explanation}
                    </div>
                </div>`;
        });
        reviewContainer.innerHTML = html;
        reviewSection.style.display = 'block';
        if (window.MathJax) {
            MathJax.typesetPromise([reviewContainer]).catch((err) => console.log(err));
        }
        reviewSection.scrollIntoView({ behavior: 'smooth' });
    }
</script>
</body>
</html>