<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIR æ»¤æ³¢å™¨è®¾è®¡ï¼šé¢‘ç‡é‡‡æ ·æ³•æ·±åº¦è§£æ</title>
    
    <!-- MathJax é…ç½® -->
    <script>
    window.MathJax = {
      tex: { 
          inlineMath: [['$', '$'], ['\\(', '\\)']], 
          displayMath: [['$$', '$$'], ['\\[', '\\]']]
      },
      options: { skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'] },
      startup: { typeset: true }
    };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        :root {
            --primary: #2b5876;
            --secondary: #4e4376;
            --accent: #ff6b6b;
            --highlight: #feca57;
            --bg: #f8f9fa;
            --text: #2d3436;
            --card-bg: #ffffff;
            --border-color: #e1e4e8;
        }

        body {
            font-family: "Segoe UI", "Microsoft YaHei", sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #dbe4ef 100%);
            color: var(--text);
            margin: 0;
            padding-bottom: 80px;
            line-height: 1.6;
        }

        .container { max-width: 1100px; margin: 0 auto; padding: 20px; }

        header {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            padding: 50px 20px;
            text-align: center;
            border-radius: 0 0 20px 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            margin-bottom: 40px;
        }
        header h1 { margin: 0; font-size: 2.2rem; }

        .card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
        }
        
        h2 { border-bottom: 3px solid var(--accent); padding-bottom: 10px; display: inline-block; color: var(--secondary); margin-top: 0; }
        h3 { color: var(--primary); margin-top: 25px; }

        /* --- åŸç†å¯¹æ¯”è¡¨æ ¼ --- */
        .comparison-table {
            width: 100%; border-collapse: collapse; margin-top: 20px;
        }
        .comparison-table th, .comparison-table td {
            border: 1px solid #ddd; padding: 12px; text-align: left;
        }
        .comparison-table th { background-color: #f1f3f5; color: var(--primary); }
        .tag-bad { color: #c0392b; font-weight: bold; background: #fadbd8; padding: 2px 6px; border-radius: 4px; font-size: 0.8rem; }
        .tag-good { color: #27ae60; font-weight: bold; background: #d5f5e3; padding: 2px 6px; border-radius: 4px; font-size: 0.8rem; }

        /* --- äº¤äº’å®éªŒåŒºå¸ƒå±€ä¼˜åŒ– --- */
        .lab-container {
            display: grid;
            grid-template-columns: 2.5fr 1fr; /* å›¾è¡¨åŒºåŸŸæ›´å®½ */
            gap: 25px;
        }
        @media (max-width: 900px) { .lab-container { grid-template-columns: 1fr; } }

        .canvas-frame {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden; /* é˜²æ­¢æº¢å‡º */
        }

        /* æ–°å¢ï¼šç‹¬ç«‹çš„å›¾è¡¨å¤´ï¼Œé¿å…é®æŒ¡ */
        .viz-header {
            background: #f8f9fa;
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
        }
        .viz-legend { display: flex; gap: 15px; }
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .dot-red { width: 10px; height: 10px; background: #e74c3c; border-radius: 50%; display: inline-block; }
        .line-blue { width: 20px; height: 3px; background: #3498db; display: inline-block; }

        canvas { width: 100%; display: block; cursor: crosshair; }
        
        .control-panel {
            background: #fff;
            border: 1px solid #e1e4e8;
            padding: 20px;
            border-radius: 8px;
            height: fit-content;
        }

        .slider-group { margin-bottom: 20px; }
        .slider-group label { display: block; font-weight: bold; margin-bottom: 8px; color: var(--primary); }
        input[type=range] { width: 100%; accent-color: var(--secondary); }

        .btn-preset {
            display: block; width: 100%;
            padding: 12px; margin-bottom: 10px;
            background: #f8f9fa; border: 1px solid #ccc;
            color: #555; border-radius: 6px;
            cursor: pointer; transition: all 0.2s;
            text-align: left;
        }
        .btn-preset:hover { background: var(--secondary); color: white; border-color: var(--secondary); }
        .btn-preset strong { display: block; margin-bottom: 2px; }
        .btn-preset small { display: block; font-size: 0.8em; opacity: 0.85; }

        .mission-box {
            background: #fff8e1; border-left: 5px solid #ffc107;
            padding: 15px; margin-bottom: 20px; border-radius: 4px;
        }

        /* --- ä¾‹é¢˜æ­¥éª¤ --- */
        .step-box {
            border-left: 4px solid var(--secondary);
            padding-left: 20px;
            margin-bottom: 30px;
        }
        .step-header { font-weight: bold; font-size: 1.1rem; color: var(--secondary); margin-bottom: 10px; }
        .calculation-box {
            background: #f1f3f5; border-radius: 5px;
            padding: 15px; margin-top: 10px;
            font-family: "Consolas", monospace; font-size: 0.9rem; border: 1px solid #e9ecef;
        }
    </style>
</head>
<body>

<header>
    <h1>FIR æ»¤æ³¢å™¨è®¾è®¡ï¼šé¢‘ç‡é‡‡æ ·æ³•</h1>
    <p>ç›´æ¥åœ¨é¢‘åŸŸâ€œä¸‹è¾¾æŒ‡ä»¤â€çš„è®¾è®¡è‰ºæœ¯ | è§£å†³çª—å‡½æ•°æ³•çš„ç—›ç‚¹</p>
</header>

<div class="container">

    <!-- 1. åŸç†å¯¹æ¯” -->
    <div class="card">
        <h2>1. ä¸ºä»€ä¹ˆè¦ç”¨é¢‘ç‡é‡‡æ ·æ³•ï¼Ÿ</h2>
        <p>é¢‘ç‡é‡‡æ ·æ³•ä¸çª—å‡½æ•°æ³•çš„è®¾è®¡è§†è§’å®Œå…¨ç›¸åã€‚çª—å‡½æ•°æ³•æ˜¯åœ¨æ—¶åŸŸâ€œæˆªæ–­â€ä¿¡å·ï¼Œè€Œé¢‘ç‡é‡‡æ ·æ³•æ˜¯ç›´æ¥åœ¨é¢‘åŸŸè®¾å®šâ€œç›®æ ‡ç‚¹â€ã€‚</p>
        
        <table class="comparison-table">
            <thead>
                <tr>
                    <th width="20%">ç‰¹æ€§</th>
                    <th width="40%">ğŸªŸ çª—å‡½æ•°æ³• (Window Method)</th>
                    <th width="40%">ğŸ“Š é¢‘ç‡é‡‡æ ·æ³• (Freq Sampling)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>æ§åˆ¶æ–¹å¼</strong></td>
                    <td>é—´æ¥æ§åˆ¶ã€‚é€šè¿‡é€‰æ‹©çª—å½¢çŠ¶æ¥å½±å“é¢‘è°±ã€‚</td>
                    <td><span class="tag-good">ç›´æ¥æ§åˆ¶</span>ã€‚ç›´æ¥è®¾å®šç‰¹å®šé¢‘ç‡ç‚¹çš„å€¼ (0æˆ–1)ã€‚</td>
                </tr>
                <tr>
                    <td><strong>ä¸»è¦ä¼˜ç‚¹</strong></td>
                    <td>é˜»å¸¦è¡°å‡å¯ä»¥åšå¾—éå¸¸å¥½ (å¦‚ Blackman çª—)ã€‚</td>
                    <td>å¯ä»¥ç²¾ç¡®æ§åˆ¶æŸäº›é¢‘ç‡ç‚¹çš„å¢ç›Šä¸º 0 (å®Œå…¨æ»¤é™¤)ã€‚è®¡ç®—ç®€å•ï¼Œæ— ç§¯åˆ†ã€‚</td>
                </tr>
                <tr>
                    <td><strong>ä¸»è¦ç¼ºç‚¹</strong></td>
                    <td><span class="tag-bad">æ— æ³•ç²¾ç¡®æ§åˆ¶</span>ã€‚ä¾‹å¦‚å¾ˆéš¾è¦æ±‚ 50Hz å¤„å¢ç›Šæ­£å¥½ä¸º 0ã€‚</td>
                    <td><span class="tag-bad">ç‚¹é—´å¤±æ§</span>ã€‚é‡‡æ ·ç‚¹ä¹‹é—´å¯èƒ½å‡ºç°å‰§çƒˆæŒ¯è¡ (é€¼è¿‘è¯¯å·®)ã€‚é˜»å¸¦è¡°å‡ä¸€èˆ¬è¾ƒå·®ã€‚</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- 2. äº¤äº’å®éªŒ -->
    <div class="card">
        <h2>2. äº¤äº’å®éªŒå®¤ï¼šä¼˜åŒ–â€œé€¼è¿‘è¯¯å·®â€</h2>
        
        <div class="mission-box">
            <strong>ğŸ¯ å®éªŒç›®æ ‡ï¼šå¯»æ‰¾â€œè½¯ç€é™†â€çš„è¿‡æ¸¡ç‚¹</strong><br>
            <ul style="margin:5px 0 0 20px; padding:0;">
                <li><strong>ç°è±¡ï¼š</strong> å½“çº¢è‰²æŸ±å­ä» 1 ç›´æ¥è·³å˜åˆ° 0 (ç¡¬ç€é™†) æ—¶ï¼Œè“è‰²æ›²çº¿åœ¨é˜»å¸¦ä¼šå‰§çƒˆæ³¢åŠ¨ï¼ˆæ—ç“£å¤§ï¼Œè¡°å‡å·®ï¼‰ã€‚</li>
                <li><strong>ä»»åŠ¡ï¼š</strong> è¯•ç€æ‹–åŠ¨é€šå¸¦ä¸é˜»å¸¦ä¹‹é—´çš„ä¸€ä¸ªçº¢è‰²æŸ±å­ï¼Œå°†å…¶å€¼è®¾ä¸º <strong>0.5 æˆ– 0.4</strong> å·¦å³ã€‚</li>
                <li><strong>è§‚å¯Ÿï¼š</strong> è“è‰²æ›²çº¿æ˜¯ä¸æ˜¯å˜å¾—æ›´å¹³æ»‘äº†ï¼Ÿè¿™å°±æ˜¯ç‰ºç‰²è¿‡æ¸¡å¸¦å®½åº¦ï¼Œæ¢å–æ›´å¥½é˜»å¸¦è¡°å‡çš„æƒè¡¡ã€‚</li>
            </ul>
        </div>

        <div class="lab-container">
            <!-- å·¦ä¾§ï¼šç»˜å›¾åŒº -->
            <div>
                <!-- é¢‘åŸŸå›¾è¡¨ -->
                <div class="canvas-frame">
                    <div class="viz-header">
                        <strong>é¢‘åŸŸå“åº”</strong>
                        <div class="viz-legend">
                            <div class="legend-item"><span class="dot-red"></span> è®¾è®¡ç›®æ ‡ H(k) (å¯æ‹–åŠ¨)</div>
                            <div class="legend-item"><span class="line-blue"></span> å®é™…å“åº” |H(Ï‰)|</div>
                        </div>
                    </div>
                    <canvas id="freqCanvas" height="300"></canvas>
                </div>
                
                <!-- æ—¶åŸŸå›¾è¡¨ -->
                <div class="canvas-frame">
                    <div class="viz-header">
                        <strong>æ—¶åŸŸè„‰å†²å“åº” h[n]</strong>
                        <div style="font-size: 0.8rem; color: #666;">ç”± IDFT è®¡ç®—å¾—å‡º</div>
                    </div>
                    <canvas id="timeCanvas" height="200"></canvas>
                </div>
            </div>

            <!-- å³ä¾§ï¼šæ§åˆ¶åŒº -->
            <div class="control-panel">
                <div class="slider-group">
                    <label>ç‚¹æ•° N = <span id="valN">15</span></label>
                    <input type="range" id="sliderN" min="7" max="31" step="2" value="15" oninput="resetSim()">
                    <div style="font-size: 0.8rem; color: #666; margin-top:5px;">å»ºè®®ä¿æŒå¥‡æ•° (Type I çº¿æ€§ç›¸ä½)</div>
                </div>

                <hr style="border:0; border-top:1px solid #eee; margin: 20px 0;">

                <label style="display:block; margin-bottom:10px; font-weight:bold; color:var(--primary);">å¿«é€Ÿé¢„è®¾ (Presets):</label>
                
                <button class="btn-preset" onclick="applyPreset('ideal')">
                    <strong>ğŸ§± ç†æƒ³ä½é€š (ç¡¬ç€é™†)</strong>
                    <small>ç›´æ¥ä»1è·³åˆ°0ï¼Œè§‚å¯Ÿè“çº¿çš„å‰§çƒˆâ€œè¿‡å†²â€</small>
                </button>
                
                <button class="btn-preset" onclick="applyPreset('transition1')">
                    <strong>ğŸ“‰ 1ä¸ªè¿‡æ¸¡ç‚¹ (è½¯ç€é™†)</strong>
                    <small>åœ¨è¾¹ç¼˜å¢åŠ ä¸€ä¸ª 0.5 çš„ç‚¹ï¼Œæ³¢çº¹æ˜¾è‘—å‡å°</small>
                </button>
                
                <button class="btn-preset" onclick="applyPreset('transition2')">
                    <strong>ğŸ“‰ğŸ“‰ 2ä¸ªè¿‡æ¸¡ç‚¹ (æ›´å¹³æ»‘)</strong>
                    <small>è¿‡æ¸¡å¸¦å˜å®½ï¼Œä½†é˜»å¸¦è¡°å‡æä½³</small>
                </button>
                
                <button class="btn-preset" onclick="applyPreset('highpass')">
                    <strong>ğŸš€ é«˜é€šæ»¤æ³¢å™¨</strong>
                    <small>åå‘è®¾ç½® H(k)ï¼Œä½“éªŒè‡ªç”±è®¾è®¡</small>
                </button>
            </div>
        </div>
    </div>

    <!-- 3. è¯¦ç»†è®¾è®¡æ­¥éª¤ä¸ä¾‹é¢˜ -->
    <div class="card">
        <h2>3. ç»¼åˆä¾‹é¢˜è¯¦è§£</h2>
        <p><strong>é¢˜ç›®ï¼š</strong> è®¾è®¡ä¸€ä¸ª $N=15$ çš„çº¿æ€§ç›¸ä½ä½é€šæ»¤æ³¢å™¨ï¼Œæˆªæ­¢é¢‘ç‡ $\omega_c = 0.4\pi$ã€‚ä½¿ç”¨é¢‘ç‡é‡‡æ ·æ³•ï¼Œå¹¶å¢åŠ ä¸€ä¸ªè¿‡æ¸¡ç‚¹ã€‚</p>

        <!-- Step 1 -->
        <div class="step-box">
            <div class="step-header">æ­¥éª¤ 1: ç¡®å®šé¢‘ç‡é‡‡æ ·ç‚¹åˆ†å¸ƒ</div>
            <p>é¢‘ç‡é‡‡æ ·é—´éš” $\Delta\omega = \frac{2\pi}{N}$ã€‚å¯¹äº $N=15$ï¼š</p>
            <div class="calculation-box">
                $$ \Delta\omega = \frac{2\pi}{15} \approx 0.133\pi $$
                é‡‡æ ·ç‚¹ä½ç½®: $\omega_k = k \cdot \frac{2\pi}{15}$
            </div>
            <p>æˆªæ­¢é¢‘ç‡ $0.4\pi$ å¯¹åº”çš„ç´¢å¼• $k \approx 3$ã€‚å› æ­¤æˆ‘ä»¬è®¾å®šï¼š</p>
            <ul>
                <li>$k=0, 1, 2$: <strong>é€šå¸¦</strong> ($|H(k)|=1$)</li>
                <li>$k=3$: <strong>è¿‡æ¸¡ç‚¹</strong> (è®¾ $|H(3)|=0.5$ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬åœ¨äº¤äº’å›¾é‡Œåšçš„æ“ä½œ)</li>
                <li>$k=4 \sim 7$: <strong>é˜»å¸¦</strong> ($|H(k)|=0$)</li>
            </ul>
        </div>

        <!-- Step 2 -->
        <div class="step-box">
            <div class="step-header">æ­¥éª¤ 2: æ„é€ ç›¸ä½ä¸ IDFT</div>
            <p>ä¸ºäº†å¾—åˆ°å®æ•°ç³»æ•° $h[n]$ï¼Œé¢‘åŸŸé‡‡æ ·å¿…é¡»æ»¡è¶³å…±è½­å¯¹ç§°æ€§ã€‚å¯¹äºçº¿æ€§ç›¸ä½ï¼Œéœ€æ–½åŠ ç›¸ä½åç§»ï¼š</p>
            <div class="calculation-box">
                $$ \theta(k) = -k \frac{N-1}{2} \frac{2\pi}{N} = -k \frac{14\pi}{15} $$
            </div>
            <p>åˆ©ç”¨åŒ–ç®€åçš„ IDFT å…¬å¼ï¼ˆä»…è®¡ç®—å‰åŠéƒ¨åˆ†éé›¶ç‚¹ï¼‰ï¼š</p>
            <div class="calculation-box">
                $$ h[n] = \frac{1}{15} \left( 1 + 2\sum_{k=1}^{3} |H(k)| \cos\left( \frac{2\pi k}{15}(n - 7) \right) \right) $$
                ä»£å…¥æ•°å€¼ï¼š
                $$ h[n] = \frac{1}{15} [ 1 + 2(1)\cos(...) + 2(1)\cos(...) + 2(0.5)\cos(...) ] $$
            </div>
            <p>è¿™å°±æ˜¯æˆ‘ä»¬åœ¨ä¸Šé¢ä»£ç ä¸­è®¡ç®— <code>h_n</code> æ•°ç»„çš„æ•°å­¦ä¾æ®ã€‚</p>
        </div>
    </div>

</div>

<script>
    // ==========================================
    // äº¤äº’é€»è¾‘æ ¸å¿ƒä»£ç 
    // ==========================================
    const canvasF = document.getElementById('freqCanvas');
    const ctxF = canvasF.getContext('2d');
    const canvasT = document.getElementById('timeCanvas');
    const ctxT = canvasT.getContext('2d');
    
    let N = 15;
    let H_mag = []; // å­˜å‚¨å‰åŠéƒ¨åˆ† magnitudes (0 to (N-1)/2)
    let isDragging = false;
    let dragIndex = -1;

    // åˆå§‹åŒ–
    function init() {
        // é»˜è®¤: ä½é€šï¼Œcutoff k=3, transition k=4
        applyPreset('transition1');
        
        // äº‹ä»¶ç›‘å¬
        canvasF.addEventListener('mousedown', onMouseDown);
        canvasF.addEventListener('mousemove', onMouseMove);
        window.addEventListener('mouseup', () => { isDragging = false; dragIndex = -1; });
        
        // è§¦æ‘¸æ”¯æŒ
        canvasF.addEventListener('touchstart', e => {
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent("mousedown", {
                clientX: touch.clientX, clientY: touch.clientY
            });
            canvasF.dispatchEvent(mouseEvent);
        }, {passive: false});
        canvasF.addEventListener('touchmove', e => {
            e.preventDefault(); // é˜²æ­¢æ»šåŠ¨
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent("mousemove", {
                clientX: touch.clientX, clientY: touch.clientY
            });
            canvasF.dispatchEvent(mouseEvent);
        }, {passive: false});
    }

    window.resetSim = function() {
        N = parseInt(document.getElementById('sliderN').value);
        document.getElementById('valN').innerText = N;
        applyPreset('ideal'); 
    }

    // åº”ç”¨é¢„è®¾
    window.applyPreset = function(type) {
        let limit = (N-1)/2;
        H_mag = new Array(limit + 1).fill(0);
        
        // åŸºç¡€æˆªæ­¢ç‚¹å¤§çº¦åœ¨ N/4 å¤„
        let cutoff = Math.floor(N/4); 

        if (type === 'ideal') {
            for(let k=0; k<=limit; k++) {
                H_mag[k] = (k <= cutoff) ? 1.0 : 0.0;
            }
        } else if (type === 'transition1') {
            for(let k=0; k<=limit; k++) {
                if(k < cutoff) H_mag[k] = 1.0;
                else if(k === cutoff) H_mag[k] = 0.5; // è¿‡æ¸¡
                else H_mag[k] = 0.0;
            }
        } else if (type === 'transition2') {
             for(let k=0; k<=limit; k++) {
                if(k < cutoff) H_mag[k] = 1.0;
                else if(k === cutoff) H_mag[k] = 0.7;
                else if(k === cutoff + 1) H_mag[k] = 0.2;
                else H_mag[k] = 0.0;
            }
        } else if (type === 'highpass') {
             for(let k=0; k<=limit; k++) {
                H_mag[k] = (k > cutoff) ? 1.0 : 0.0;
            }
        }
        update();
    };

    // äº¤äº’å¤„ç†
    function getMousePos(evt) {
        const rect = canvasF.getBoundingClientRect();
        return {
            x: evt.clientX - rect.left,
            y: evt.clientY - rect.top
        };
    }

    function onMouseDown(e) {
        const pos = getMousePos(e);
        const w = canvasF.width;
        const h = canvasF.height;
        const paddingLeft = 40;
        const paddingRight = 20;
        const paddingTop = 20;
        const paddingBottom = 30;
        
        const plotW = w - paddingLeft - paddingRight;
        const plotH = h - paddingTop - paddingBottom;
        const limit = (N-1)/2;
        const step = plotW / limit;

        // å¯»æ‰¾æœ€è¿‘çš„ bar
        let idx = -1;

        for(let k=0; k<=limit; k++) {
            let x = paddingLeft + k * step;
            // Xè½´å®¹å·®
            let dx = Math.abs(pos.x - x);
            if (dx < step/2.5) {
                idx = k;
                break;
            }
        }

        if(idx !== -1) {
            isDragging = true;
            dragIndex = idx;
            onMouseMove(e); // ç«‹å³æ›´æ–°
        }
    }

    function onMouseMove(e) {
        if(!isDragging || dragIndex === -1) return;
        const pos = getMousePos(e);
        const h = canvasF.height;
        const paddingTop = 20;
        const paddingBottom = 30;
        const plotH = h - paddingTop - paddingBottom;

        // è®¡ç®—æ–°çš„ magnitude (å€’ç½®Yè½´)
        let val = 1.0 - (pos.y - paddingTop) / plotH;
        
        // Clamp
        if(val > 1.1) val = 1.1;
        if(val < -0.1) val = -0.1;
        
        // å¸é™„åŠŸèƒ½ (Snap)
        if(Math.abs(val) < 0.05) val = 0;
        if(Math.abs(val-1) < 0.05) val = 1;
        if(Math.abs(val-0.5) < 0.05) val = 0.5;

        H_mag[dragIndex] = val;
        update();
    }

    // æ ¸å¿ƒè®¡ç®—ä¸ç»˜å›¾
    function update() {
        calculateImpulse(); // è®¡ç®— h[n]
        drawFreq();         // ç”» H(k) å’Œ æ’å€¼æ›²çº¿
        drawTime();         // ç”» h[n]
    }

    let h_n = []; // æ—¶åŸŸç³»æ•°

    // IDFT å…¬å¼å®ç°
    function calculateImpulse() {
        h_n = new Array(N).fill(0);
        const alpha = (N-1)/2;
        
        for(let n=0; n<N; n++) {
            let sum = 0;
            // k=0 term
            sum += H_mag[0];
            // k=1 to (N-1)/2 terms
            for(let k=1; k<=(N-1)/2; k++) {
                sum += 2 * H_mag[k] * Math.cos( (2*Math.PI*k/N) * (n - alpha) );
            }
            h_n[n] = sum / N;
        }
    }

    // DTFT æ’å€¼è®¡ç®— (High Res Spectrum)
    function calculateDTFT(points=200) {
        let spectrum = [];
        for(let i=0; i<points; i++) {
            let omega = i * Math.PI / (points-1); // 0 to pi
            let real = 0;
            let imag = 0;
            for(let n=0; n<N; n++) {
                real += h_n[n] * Math.cos(omega * n);
                imag -= h_n[n] * Math.sin(omega * n);
            }
            spectrum.push(Math.sqrt(real*real + imag*imag));
        }
        return spectrum;
    }

    function drawFreq() {
        canvasF.width = canvasF.clientWidth;
        canvasF.height = canvasF.clientHeight;
        const w = canvasF.width;
        const h = canvasF.height;
        
        // è°ƒæ•´è¾¹è·ï¼Œé…åˆä¸Šæ–¹ Header
        const paddingLeft = 40;
        const paddingRight = 20;
        const paddingTop = 20;
        const paddingBottom = 30;
        
        const plotW = w - paddingLeft - paddingRight;
        const plotH = h - paddingTop - paddingBottom;

        ctxF.clearRect(0,0,w,h);
        
        // åæ ‡è½´
        ctxF.beginPath(); ctxF.strokeStyle="#eee"; ctxF.lineWidth=1;
        // Yè½´çº¿
        ctxF.moveTo(paddingLeft, paddingTop); ctxF.lineTo(paddingLeft, h-paddingBottom);
        // Xè½´çº¿
        ctxF.moveTo(paddingLeft, h-paddingBottom); ctxF.lineTo(w-paddingRight, h-paddingBottom);
        // æ°´å¹³ç½‘æ ¼ (0, 0.5, 1)
        [0, 0.5, 1].forEach(val => {
            let y = h - paddingBottom - val * plotH;
            ctxF.moveTo(paddingLeft, y); ctxF.lineTo(w-paddingRight, y);
            ctxF.fillStyle="#999"; ctxF.font="11px Arial"; ctxF.textAlign="right";
            ctxF.fillText(val, paddingLeft-5, y+4);
        });
        ctxF.stroke();

        // 1. ç»˜åˆ¶è“è‰²æ’å€¼æ›²çº¿ (DTFT)
        const dtft = calculateDTFT(w); 
        ctxF.beginPath(); ctxF.strokeStyle = "#3498db"; ctxF.lineWidth = 2;
        for(let i=0; i<dtft.length; i++) {
            let x = paddingLeft + (i/(dtft.length-1)) * plotW;
            let val = dtft[i];
            let y = h - paddingBottom - val * plotH;
            if(i===0) ctxF.moveTo(x,y); else ctxF.lineTo(x,y);
        }
        ctxF.stroke();

        // 2. ç»˜åˆ¶çº¢è‰²é‡‡æ ·ç‚¹ H(k)
        const limit = (N-1)/2;
        const step = plotW / limit; 
        
        for(let k=0; k<=limit; k++) {
            let x = paddingLeft + k * step;
            let val = H_mag[k];
            let y = h - paddingBottom - val * plotH;

            // Stick
            ctxF.beginPath(); ctxF.strokeStyle = "#e74c3c"; ctxF.lineWidth = 4;
            ctxF.moveTo(x, h-paddingBottom); ctxF.lineTo(x, y); ctxF.stroke();

            // Cap (Handle)
            ctxF.beginPath(); ctxF.fillStyle = "#c0392b";
            ctxF.arc(x, y, 7, 0, Math.PI*2); ctxF.fill(); // åŠ å¤§ä¸€ç‚¹ä¾¿äºè§¦æ‘¸

            // Label Index
            ctxF.fillStyle = "#666"; ctxF.textAlign="center"; ctxF.font="12px Arial";
            ctxF.fillText(k, x, h-10);
        }
        
        // æ ‡è®° PI
        ctxF.fillStyle="#333"; ctxF.fillText("Ï€", w-paddingRight, h-10);
    }

    function drawTime() {
        canvasT.width = canvasT.clientWidth;
        canvasT.height = canvasT.clientHeight;
        const w = canvasT.width;
        const h = canvasT.height;
        
        const paddingLeft = 40;
        const paddingRight = 20;
        const paddingTop = 20;
        const paddingBottom = 30;

        ctxT.clearRect(0,0,w,h);
        
        const midY = paddingTop + (h - paddingTop - paddingBottom)/2;
        const plotW = w - paddingLeft - paddingRight;
        const step = plotW / (N-1);
        
        // Axis
        ctxT.beginPath(); ctxT.strokeStyle="#ccc";
        ctxT.moveTo(paddingLeft, midY); ctxT.lineTo(w-paddingRight, midY);
        ctxT.stroke();

        // å¯»æ‰¾ h[n] æœ€å¤§å€¼ä»¥ç¼©æ”¾
        let maxVal = 0;
        h_n.forEach(v => { if(Math.abs(v)>maxVal) maxVal = Math.abs(v); });
        if(maxVal === 0) maxVal = 1;
        const scaleY = (h - paddingTop - paddingBottom) / 2 / (maxVal * 1.1);

        // Draw Stems
        for(let n=0; n<N; n++) {
            let x = paddingLeft + n*step;
            let y = midY - h_n[n] * scaleY;
            
            ctxT.beginPath(); ctxT.strokeStyle = "#2c3e50"; ctxT.lineWidth = 2;
            ctxT.moveTo(x, midY); ctxT.lineTo(x, y); ctxT.stroke();
            
            ctxT.beginPath(); ctxT.fillStyle = "#2c3e50";
            ctxT.arc(x, y, 3, 0, Math.PI*2); ctxT.fill();
            
            // Index Text
            if(N < 20 || n%2===0) {
                 ctxT.fillStyle = "#999"; ctxT.font="10px Arial"; ctxT.textAlign="center";
                 ctxT.fillText(n, x, h-10);
            }
        }
    }

    // å¯åŠ¨
    init();

</script>

</body>
</html>